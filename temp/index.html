<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desmos API: Typing Simulation</title>
    
    <script src="https://www.desmos.com/api/v1.9/calculator.js?apiKey=dcb31709b452b1cf9dc26972add0fda6"></script>

    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f0f0;
        }

        #header {
            padding: 20px;
            text-align: center;
        }

        /* Container for the calculator */
        #calculator {
            width: 800px;
            height: 600px;
            border: 2px solid #333;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        #status {
            margin-top: 10px;
            font-style: italic;
            color: #555;
        }
    </style>
</head>
<body>

    <div id="header">
        <h2>Desmos Scripted Presentation</h2>
        <button onclick="startPresentation()">Replay Animation</button>
    </div>

    <div id="calculator"></div>
    <div id="status">Status: Ready...</div>

    <script>
        // 1. Initialize the Calculator
        var elt = document.getElementById('calculator');
        var calculator = Desmos.GraphingCalculator(elt, {
            keypad: false,       // Hide keypad for cleaner "presentation" look
            expressions: false,  // Hide the side list to focus on the graph
            settingsMenu: false  // Hide settings for presentation mode
        });

        // The equation to "type"
        const finalEquation = "y=x^2";
        const expressionId = 'graph1';
        
        // Animation settings
        const typingSpeed = 300; // ms per character
        
        // Run automatically on load
        window.onload = () => {
            setTimeout(startPresentation, 1000);
        };

        function startPresentation() {
            // Reset graph
            calculator.setBlank();
            // Reset View
            calculator.setMathBounds({
                left: -10,
                right: 10,
                bottom: -10,
                top: 10
            });
            
            document.getElementById('status').innerText = "Status: Typing equation...";
            
            // Start the recursive typing loop
            typeCharacter(0);
        }

        // 2. Logic to Simulate Typing
        function typeCharacter(index) {
            if (index <= finalEquation.length) {
                // substring(0, index) grabs the characters typed so far
                const currentString = finalEquation.substring(0, index);
                
                // Update the calculator state
                calculator.setExpression({ 
                    id: expressionId, 
                    latex: currentString,
                    color: Desmos.Colors.BLUE 
                });

                // Schedule next character
                setTimeout(function() {
                    typeCharacter(index + 1);
                }, typingSpeed);
            } else {
                // Typing is complete, trigger the viewport change
                document.getElementById('status').innerText = "Status: Equation complete. Adjusting viewport...";
                setTimeout(focusOnVertex, 500);
            }
        }

        // 3. Logic to Control Viewport (Zoom to Vertex)
        function focusOnVertex() {
            // The vertex of y=x^2 is (0,0). We zoom in close to that point.
            calculator.setMathBounds({
                left: -2,
                right: 2,
                bottom: -1,
                top: 3
            });
            document.getElementById('status').innerText = "Status: Presentation finished.";
        }
    </script>
</body>
</html>
