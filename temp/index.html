<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desmos Human Tutor Simulation</title>
    
    <script src="https://www.desmos.com/api/v1.10/calculator.js?apiKey=dcb31709b452b1cf9dc26972add0fda6"></script>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
        }
        h2 { color: #2c3e50; margin-bottom: 10px; }
        
        /* Container to make it look like a software demo */
        #demo-container {
            width: 900px;
            height: 600px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            overflow: hidden; /* keeps corners rounded */
            background: white;
        }

        #calculator {
            width: 100%;
            height: 100%;
        }

        #tutor-commentary {
            margin-top: 15px;
            padding: 10px 20px;
            background: #fff;
            border-left: 5px solid #2e7d32;
            color: #333;
            width: 860px;
            font-style: italic;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body>

    <h2>Virtual Math Tutor</h2>
    
    <div id="demo-container">
        <div id="calculator"></div>
    </div>

    <div id="tutor-commentary">
        Tutor: "Initializing session..."
    </div>

    <script>
        // --- 1. SETUP ---
        var elt = document.getElementById('calculator');
        var commentary = document.getElementById('tutor-commentary');
        
        // Initialize with expressions panel OPEN
        var calculator = Desmos.GraphingCalculator(elt, {
            expressions: true, // Ensure the left panel is visible
            keypad: true       // Show keypad for realism
        });

        // --- 2. HELPER FUNCTIONS FOR "HUMAN" FEEL ---

        function updateTutor(text) {
            commentary.textContent = 'Tutor: "' + text + '"';
        }

        // Returns a random delay between min and max ms to simulate distinct keystrokes
        function getRandomTypingDelay() {
            // Fast typist: between 100ms and 300ms per key
            return Math.floor(Math.random() * 200) + 100;
        }

        // --- 3. SMOOTH ANIMATION LOGIC (The "Panning" Effect) ---
        
        // Smoothly interpolates from current bounds to target bounds over 'duration' ms
        function smoothZoomTo(targetBounds, duration) {
            const startBounds = calculator.graphpaperBounds.mathCoordinates;
            const startTime = performance.now();

            function step(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Easing function (Ease-in-out cubic) for natural movement
                // This makes it start slow, speed up, then slow down at the end
                const ease = progress < 0.5 ? 4 * progress * progress * progress : 1 - Math.pow(-2 * progress + 2, 3) / 2;

                // Calculate intermediate values
                const currentLeft = startBounds.left + (targetBounds.left - startBounds.left) * ease;
                const currentRight = startBounds.right + (targetBounds.right - startBounds.right) * ease;
                const currentBottom = startBounds.bottom + (targetBounds.bottom - startBounds.bottom) * ease;
                const currentTop = startBounds.top + (targetBounds.top - startBounds.top) * ease;

                calculator.setMathBounds({
                    left: currentLeft,
                    right: currentRight,
                    bottom: currentBottom,
                    top: currentTop
                });

                if (progress < 1) {
                    requestAnimationFrame(step);
                } else {
                    updateTutor("Here is the vertex at (0,0). Notice the symmetry.");
                }
            }
            
            requestAnimationFrame(step);
        }


        // --- 4. TYPING LOGIC ---

        var equationToType = "y=x^2";
        
        function humanType(index, currentStr) {
            if (index < equationToType.length) {
                
                let char = equationToType[index];
                currentStr += char;

                // Update the calculator state
                calculator.setExpression({ id: 'graph1', latex: currentStr });

                // Determine delay for next keystroke
                let delay = getRandomTypingDelay();
                
                // If we hit the equals sign or power, add a slight "thinking" pause
                if (char === '=' || char === '^') delay += 400;

                setTimeout(() => {
                    humanType(index + 1, currentStr);
                }, delay);
            } else {
                // Finished typing
                updateTutor("Okay, we have our parabola. Let's take a closer look...");
                
                // Wait 1.5 seconds before moving the camera
                setTimeout(() => {
                    // Target viewport: Zoomed in on vertex (0,0)
                    smoothZoomTo({ left: -2, right: 2, bottom: -1, top: 3 }, 2000); 
                }, 1500);
            }
        }

        // --- 5. START THE SCRIPT ---
        
        setTimeout(() => {
            updateTutor("Today we're going to graph a simple quadratic equation.");
            
            setTimeout(() => {
                updateTutor("Typing equation...");
                humanType(0, "");
            }, 2000);

        }, 1000);

    </script>
</body>
</html>
