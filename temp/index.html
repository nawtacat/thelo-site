<!DOCTYPE html>
<html>
<head>
    <title>Desmos API Typing and Zoom Demo (FIXED)</title>
    <style>
        /* Styles to make the calculator visible on the page */
        #calculator {
            width: 600px;
            height: 400px;
            border: 1px solid #333;
            margin: 20px auto;
        }
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }
    </style>
    <script src="https://www.desmos.com/api/v1.9/calculator.js"></script>
</head>
<body>

    <h1>Desmos API Demo: Typing and Zoom</h1>
    <p>Click the button to start the scripted demonstration. Watch the equation bar and the graph!</p>
    
    <div id="calculator"></div>
    <button onclick="startDemo()">Run Demonstration</button>

    <script>
        let calculator;
        
        // This function initializes the calculator once the page (and Desmos API) loads
        window.onload = function() {
            const elt = document.getElementById('calculator');
            // Initialize the calculator with some basic settings
            calculator = Desmos.Calculator(elt, {
                keypad: false,
                expressions: false,
                settingsMenu: false
            });
            // Set an initial default view
            calculator.setMathBounds({ left: -10, right: 10, bottom: -10, top: 10 });
        };

        // The core function to run the scripted demo
        function startDemo() {
            // Define the equation to "type"
            const fullEquation = 'y=x^2'; 
            
            // Start with an empty expression, giving it a unique ID
            calculator.setExpression({ id: 'demoEq', latex: '' });
            
            let currentIndex = 0;
            const typingInterval = 150; // Milliseconds between each character

            // Function to simulate typing one character at a time
            function typeNextCharacter() {
                if (currentIndex < fullEquation.length) {
                    const currentLatex = fullEquation.substring(0, currentIndex + 1);
                    
                    // Update the expression in Desmos with the new substring
                    calculator.setExpression({ id: 'demoEq', latex: currentLatex });
                    
                    currentIndex++;
                    
                    // Schedule the next character to be typed
                    setTimeout(typeNextCharacter, typingInterval);
                } else {
                    // All characters are typed, now perform the zoom/pan action
                    setTimeout(zoomToFocus, 1500); // Wait 1.5 seconds after typing finishes
                }
            }

            // Function to zoom and pan the graph (Viewport Control)
            function zoomToFocus() {
                // Set the viewport (x-min, x-max, y-min, y-max)
                // Zooms in to focus on the vertex (0,0) and the surrounding area.
                calculator.setMathBounds({
                    left: -2,    // X-min
                    right: 2,   // X-max
                    bottom: -1, // Y-min
                    top: 5      // Y-max
                });
            }

            // Begin the typing process
            typeNextCharacter();
        }
    </script>

</body>
</html>
