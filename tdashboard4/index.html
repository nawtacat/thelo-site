<!DOCTYPE html>
<!-- 
  UX Enhancements (v7 - Navbar/Group Selection):
  - Increased navbar vertical padding (py-6) and logo size (h-12) for more presence.
  - Replaced the custom dropdown with a more robust "pill" selection system.
  - Groups now display as a flex-wrap list of selectable buttons.
  - Removed all JS and CSS related to the old dropdown.
  - Added new CSS for `.group-pill-btn` and its active state.
  - Simplified JS logic in `loadGroups` and `handleGroupSelect` to work with the new pill system.
-->
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-i18n="title">Tutor Dashboard | thelo</title>
    <link rel="icon" href="https://thelo.space/img/thelofavicon.png" type="image/png" />
    <link rel="apple-touch-icon" href="https://thelo.space/img/yarnicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Font Import for Manrope (Montserrat Arm is self-hosted via @font-face) -->
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;700;800&display=swap" rel="stylesheet">

  <style>
    /*
     * ============================================
     * Custom Font Definitions for Armenian (Montserrat Arm)
     * ============================================
     */
    @font-face {
      font-family: 'Montserrat Arm';
      src: url('https://thelo.space/fonts/Montserratarm-Regular.otf') format('opentype');
      font-weight: 400; /* Regular */
      font-style: normal;
      font-display: swap;
      unicode-range: U+0530-058F, U+FB13-FB17;
    }
    @font-face {
      font-family: 'Montserrat Arm';
      src: url('https://thelo.space/fonts/Montserratarm-SemiBold.otf') format('opentype');
      font-weight: 600; /* SemiBold */
      font-style: normal;
      font-display: swap;
      unicode-range: U+0530-058F, U+FB13-FB17;
    }
    @font-face {
      font-family: 'Montserrat Arm';
      src: url('https://thelo.space/fonts/Montserratarm-ExtraBold.otf') format('opentype');
      font-weight: 800; /* ExtraBold */
      font-style: normal;
      font-display: swap;
      unicode-range: U+0530-058F, U+FB13-FB17;
    }

    /*
     * ============================================
     * Main Site Styles
     * ============================================
     */
    :root {
        --thelo-blue: #2563EB;
        --thelo-bg: #F8F9FA;
        --thelo-text: #111827;
        --grid-color: #E5E7EB;
    }
    html { scroll-behavior: smooth; }
    body {
        font-family: 'Montserrat Arm', 'Manrope', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
        background-color: var(--thelo-bg);
        color: var(--thelo-text);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        background-image:
            linear-gradient(to right, var(--grid-color) 1px, transparent 1px),
            linear-gradient(to bottom, var(--grid-color) 1px, transparent 1px);
        background-size: 40px 40px;
        min-height: 100vh;
    }

    h1, h2, h3, h4, h5, h6 { font-weight: 800; }

    .nav-link { 
        @apply font-semibold text-[var(--thelo-text)] transition-colors duration-200;
    }
    .nav-link:hover { 
        color: var(--thelo-blue); 
    }

    .window-container {
        position: relative;
        background-color: white;
        border: 1px solid var(--grid-color);
        border-radius: 0.75rem; 
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1); 
        padding: 2.5rem; 
    }
    .window-container::before {
        content: ' ';
        position: absolute;
        top: 1.5rem; 
        left: 1.5rem; 
        width: 52px;
        height: 12px;
        background-image: url("data:image/svg+xml,%3Csvg width='52' height='12' viewBox='0 0 52 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='6' cy='6' r='6' fill='%23FF5F56'/%3E%3Ccircle cx='26' cy='6' r='6' fill='%23FFBD2E'/%3E%3Ccircle cx='46' cy='6' r='6' fill='%2327C93F'/%3E%3C/svg%3E%0A");
        background-repeat: no-repeat;
        z-index: 1;
    }
    /* Button Styles */
    .thelo-btn, .thelo-btn-secondary, .thelo-btn-destructive {
        font-weight: 700; padding: 0.75rem 1.5rem; border-radius: 0.5rem;
        transition: all 0.2s ease-in-out; display: inline-flex; align-items: center;
        justify-content: center; border: 1px solid transparent; cursor: pointer;
    }
    .thelo-btn {
        background-color: var(--thelo-blue); color: white;
    }
    .thelo-btn:hover {
        background-color: #1a56d2; transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }
    .thelo-btn-secondary {
        background-color: transparent; color: var(--thelo-blue); border-color: var(--thelo-blue);
    }
    .thelo-btn-secondary:hover {
        background-color: var(--thelo-blue); color: white;
    }
    .thelo-btn-secondary-sm {
        font-weight: 600; padding: 0.375rem 0.75rem; font-size: 0.875rem;
        border-radius: 0.375rem; transition: all 0.2s ease-in-out; display: inline-flex;
        align-items: center; justify-content: center; border: 1px solid var(--thelo-blue);
        background-color: transparent; color: var(--thelo-blue); cursor: pointer;
    }
     .thelo-btn-secondary-sm:hover {
         background-color: var(--thelo-blue); color: white;
     }
    .thelo-btn:disabled, .thelo-btn-secondary:disabled, .thelo-btn-secondary-sm:disabled {
        background-color: #cbd5e1; border-color: #cbd5e1; color: #64748b;
        cursor: not-allowed; transform: none; box-shadow: none;
    }
    .input-field {
        width: 100%; padding: 0.75rem 1rem; border: 1px solid #d1d5db; border-radius: 0.5rem;
        background-color: #f8fafc; transition: all 0.2s ease-in-out;
    }
    .input-field:focus {
        outline: none; box-shadow: 0 0 0 2px #3b82f6; background-color: white;
    }
    .lang-btn {
        cursor: pointer; font-weight: 700; color: #94a3b8;
    }
    .lang-btn.active {
        color: var(--thelo-blue);
    }
    /* Notification Toast Styles */
    #notification-toast {
        position: fixed; bottom: 1.25rem; right: 1.25rem; background-color: #16a34a;
        color: white; padding: 1rem; border-radius: 0.5rem; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
        transition: all 0.3s ease-in-out; transform: translateY(2.5rem); opacity: 0; z-index: 50;
    }
    #notification-toast.show { transform: none; opacity: 1; }
    #notification-toast.error { background-color: #dc2626; }
    /* Tab Styles */
    .tab-btn {
        border-bottom: 2px solid transparent; color: #64748b; white-space: nowrap;
        padding: 1rem 0.25rem; font-weight: 500; font-size: 0.875rem; cursor: pointer;
    }
    .tab-btn:hover { color: #334155; border-color: #d1d5db; }
    .tab-btn.active { border-color: var(--thelo-blue); color: var(--thelo-blue); }
    .tab-panel { padding-top: 1.5rem; padding-bottom: 1.5rem; }
    /* Modal Styles */
    .modal-overlay {
        position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5);
        display: flex; justify-content: center; align-items: center; z-index: 1000;
        backdrop-filter: blur(4px); opacity: 0; transition: opacity 0.3s ease-out; padding: 1rem;
    }
    .modal-overlay.hidden { display: none; }
    .modal-overlay:not(.hidden) { display: flex; }
    .modal-overlay.show { opacity: 1; }
    .modal-content {
        background: white; padding: 2rem; border-radius: 0.75rem; box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        width: 100%; position: relative; opacity: 0; transform: scale(0.95);
        transition: opacity 0.3s ease-out, transform 0.3s ease-out;
    }
    .modal-overlay.show .modal-content { opacity: 1; transform: scale(1); }
    .modal-label { font-weight: 600; font-size: 0.875rem; display: block; color: #334155; }
    .modal-content .input-field { margin-top: 0.25rem; }
    .modal-close-btn {
        position: absolute; top: 1rem; right: 1rem; font-size: 1.875rem;
        font-weight: 300; color: #94a3b8; cursor: pointer; z-index: 10;
    }
    .modal-close-btn:hover { color: #334155; }
    #result-modal-content { max-width: 56rem; }
    #create-group-modal-content { max-width: 28rem; }
    /* Question Detail Styles */
    .question-item { border: 1px solid #e2e8f0; border-radius: 0.5rem; padding: 1rem; }
    .question-header { display: flex; justify-content: space-between; align-items: center; }
    .question-title { font-size: 1.125rem; font-weight: 700; color: #1e293b; }
    .question-status-correct { font-size: 0.875rem; font-weight: 700; background-color: #dcfce7; color: #15803d; padding: 0.25rem 0.75rem; border-radius: 9999px; }
    .question-status-incorrect { font-size: 0.875rem; font-weight: 700; background-color: #fee2e2; color: #b91c1c; padding: 0.25rem 0.75rem; border-radius: 9999px; }
    .question-status-other { font-size: 0.875rem; font-weight: 700; background-color: #f1f5f9; color: #334155; padding: 0.25rem 0.75rem; border-radius: 9999px; }
    .question-body { margin-top: 1rem; display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
    @media (min-width: 1024px) { .question-body { grid-template-columns: repeat(5, 1fr); } }
    .question-label { display: block; font-size: 0.75rem; font-weight: 600; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem; }
    .student-solution-img { width: 100%; height: auto; background-color: white; border: 1px solid #d1d5db; border-radius: 0.375rem; object-fit: contain; }
    .feedback-text { padding: 0.75rem; background-color: #f8fafc; border-radius: 0.375rem; color: #334155; font-size: 0.875rem; max-width: none; }
    .feedback-text p { margin: 0; }
    .feedback-text .mt-2 { margin-top: 0.5rem; }
    .feedback-text .text-xs { font-size: 0.75rem; }
    .feedback-text strong { font-weight: 700; }
    /* --- NEW Group Pill Styles --- */
    .group-pill-btn {
        padding: 0.5rem 1rem; border: 1px solid var(--thelo-blue); border-radius: 0.5rem;
        color: var(--thelo-blue); font-weight: 600; transition: all 0.2s ease-in-out;
        cursor: pointer; font-size: 0.875rem;
    }
    .group-pill-btn:hover { background-color: var(--thelo-blue); color: white; }
    .group-pill-btn:disabled {
        background-color: #f1f5f9; color: #94a3b8; border-color: #e2e8f0;
        cursor: not-allowed;
    }
    .group-pill-btn:disabled:hover {
        background-color: #f1f5f9; color: #94a3b8; border-color: #e2e8f0;
    }
    .group-pill-btn.active {
        background-color: #eff6ff; border-color: #60a5fa; color: #2563eb;
        box-shadow: 0 0 0 2px #bfdbfe;
    }
    /* --- FINAL FIX: Active state for the secondary button style --- */
    /* This rule ensures that when a button is active, it STAYS blue, even when hovered. */
    .thelo-btn-secondary.active {
        background-color: var(--thelo-blue); color: white;
    }
    /* --- END NEW Styles --- */
    /* Responsive Styles */
    @media (max-width: 767px) {
        main { padding-left: 1rem; padding-right: 1rem; }
        h1 { font-size: 2.5rem; }
        h2 { font-size: 1.75rem; }
        .window-container { padding: 2rem 1rem; border-radius: 1rem; }
        .window-container::before { top: 1rem; left: 1rem; transform: scale(0.8); transform-origin: top left; }
        .modal-content { margin: 1rem; }
        .nav-link { font-size: 0.875rem; }
        .thelo-btn-secondary { padding: 0.5rem 0.75rem; font-size: 0.875rem; }
    }
    /* General Layout Classes */
    .hidden { display: none; }
    .w-full { width: 100%; }
    .z-40 { z-index: 40; }
    .mx-auto { margin-left: auto; margin-right: auto; }
    .flex { display: flex; }
    .items-center { align-items: center; }
    .justify-between { justify-content: space-between; }
    .max-w-7xl { max-width: 80rem; }
    .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
    .py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
    .gap-4 { gap: 1rem; }
    .h-12 { height: 3rem; }
    .w-auto { width: auto; }
    .border-l { border-left-width: 1px; }
    .pl-3 { padding-left: 0.75rem; }
    .ml-1 { margin-left: 0.25rem; }
    .text-lg { font-size: 1.125rem; }
    .font-bold { font-weight: 700; }
    .text-slate-600 { color: #475569; }
    .hidden.md\:flex { display: none; }
    @media (min-width: 768px) { .hidden.md\:flex { display: flex; } }
    .gap-6 { gap: 1.5rem; }
    .text-sm { font-size: 0.875rem; }
    .border-l { border-left-width: 1px; }
    .pl-4 { padding-left: 1rem; }
    .ml-2 { margin-left: 0.5rem; }
    .text-slate-300 { color: #d1d5db; }
    .pt-12 { padding-top: 3rem; }
    .pb-16 { padding-bottom: 4rem; }
    .lg\:pt-16 { } @media (min-width: 1024px) { .lg\:pt-16 { padding-top: 4rem; } }
    .lg\:pb-24 { } @media (min-width: 1024px) { .lg\:pb-24 { padding-bottom: 6rem; } }
    .lg\:px-8 { } @media (min-width: 1024px) { .lg\:px-8 { padding-left: 2rem; padding-right: 2rem; } }
    .text-center { text-align: center; }
    .py-20 { padding-top: 5rem; padding-bottom: 5rem; }
    .max-w-3xl { max-width: 48rem; }
    .text-3xl { font-size: 1.875rem; }
    .text-red-600 { color: #dc2626; }
    .mt-4 { margin-top: 1rem; }
    .inline-block { display: inline-block; }
    .mt-8 { margin-top: 2rem; }
    .flex-col { flex-direction: column; }
    .md\:flex-row { } @media (min-width: 768px) { .md\:flex-row { flex-direction: row; } }
    .mb-8 { margin-bottom: 2rem; }
    .text-4xl { font-size: 2.25rem; }
    .font-extrabold { font-weight: 800; }
    .tracking-tighter { letter-spacing: -0.05em; }
    .sm\:text-5xl { } @media (min-width: 640px) { .sm\:text-5xl { font-size: 3rem; } }
    .md\:hidden { display: block; } @media (min-width: 768px) { .md\:hidden { display: none; } }
    .mb-12 { margin-bottom: 3rem; }
    .mb-3 { margin-bottom: 0.75rem; }
    .block { display: block; }
    .grid { display: grid; }
    .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
    .sm\:grid-cols-2 { } @media (min-width: 640px) { .sm\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
    .lg\:grid-cols-3 { } @media (min-width: 1024px) { .lg\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); } }
    .mt-3 { margin-top: 0.75rem; }
    .text-slate-500 { color: #64748b; }
    .mt-2 { margin-top: 0.5rem; }
    .text-2xl { font-size: 1.5rem; }
    .py-16 { padding-top: 4rem; padding-bottom: 4rem; }
    .h-12 { height: 3rem; }
    .w-12 { width: 3rem; }
    .text-slate-400 { color: #94a3b8; }
    .font-semibold { font-weight: 600; }
    .text-slate-800 { color: #1e293b; }
    .mt-1 { margin-top: 0.25rem; }
    .border-b { border-bottom-width: 1px; }
    .border-slate-200 { border-color: #e2e8f0; }
    .space-x-8 > :not([hidden]) ~ :not([hidden]) { margin-left: 2rem; }
    .overflow-x-auto { overflow-x: auto; }
    .min-w-full { min-width: 100%; }
    .divide-y > :not([hidden]) ~ :not([hidden]) { border-top-width: 1px; }
    .divide-slate-200 > :not([hidden]) ~ :not([hidden]) { border-color: #e2e8f0; }
    .bg-slate-50 { background-color: #f8fafc; }
    .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
    .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
    .text-left { text-align: left; }
    .text-xs { font-size: 0.75rem; }
    .uppercase { text-transform: uppercase; }
    .tracking-wider { letter-spacing: 0.05em; }
    .relative { position: relative; }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0; }
    .bg-white { background-color: #fff; }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0; }
    .italic { font-style: italic; }
    .max-h-96 { max-height: 24rem; }
    .overflow-y-auto { overflow-y: auto; }
    .space-y-4 > :not([hidden]) ~ :not([hidden]) { margin-top: 1rem; }
    .w-full { width: 100%; }
    .lg\:col-span-2 { } @media (min-width: 1024px) { .lg\:col-span-2 { grid-column: span 2 / span 2; } }
    .lg\:col-span-3 { } @media (min-width: 1024px) { .lg\:col-span-3 { grid-column: span 3 / span 3; } }
   </style>
</head>

<body class="antialiased">

<!-- Navbar: Increased height and logo size -->
<nav id="mainNav"> 
    <div class="nav-inner-container">
        <a href="/" class="logo-link">
            <img src="https://thelo.space/img/bluethelo.svg" alt="thelo logo" class="logo-img" />
        </a>
       
        <div class="nav-actions">
            <button id="nav-create-group-btn" class="thelo-btn-secondary nav-create-btn-desktop" data-i18n="navCreateGroup"> 
                Create Group
            </button>
            <ul class="nav-links-desktop">
                <li><a href="#" id="logout-btn" class="nav-link" data-i18n="navLogout">Log Out</a></li>
            </ul>
            <div class="lang-switcher">
                <span id="lang-en" class="lang-btn">EN</span>
                <span>|</span>
                <span id="lang-hy" class="lang-btn">HY</span>
            </div>
        </div>
    </div>
</nav>

<main>
    <div class="main-container">

        <div id="loading-state" class="loading-state">
            <h2 class="text-2xl font-bold text-slate-600" data-i18n="loading">Loading Dashboard...</h2>
        </div>

        <div id="error-state" class="hidden error-state window-container">
            <h2 data-i18n="errorTitle">Access Denied</h2>
            <p data-i18n="errorSubtitle">You must be a registered tutor to access this page. Please contact support if you believe this is an error.</p>
            <a href="/" class="thelo-btn" data-i18n="errorButton">Back to Home</a>
        </div>

        <div id="dashboard-content" class="hidden">
            <div class="dashboard-header"> 
                <div>
                    <h1 data-i18n="dashboardTitle">Tutor Dashboard</h1>
                    <p id="welcome-message" data-i18n="dashboardSubtitle">Welcome, tutor. Select a group to get started.</p>
                </div>
                <button id="nav-create-group-btn-mobile" class="thelo-btn-secondary create-btn-mobile" data-i18n="navCreateGroupShort">
                    New
                </button>
            </div>

            <!-- === FULL-WIDTH LAYOUT === -->
            <div class="dashboard-main-panel"> 
                <section class="w-full window-container">
                    <div class="content-wrapper">
                       
                        <!-- 1. Group Selection -->
                        <div class="group-selection-wrapper">
                            <div id="group-selection-container" class="group-grid">
                                <!-- JS populates this area -->
                            </div>
                             <p id="no-groups-msg" class="no-groups-msg hidden" data-i18n="groupsNone">You haven't created any groups yet.</p>
                        </div>
                                   
                        <!-- 2. Results Title -->
                        <h2 id="results-title" class="results-title" data-i18n="resultsTitleDefault">Select a group</h2>
                       
                        <!-- 3. Empty State -->
                        <div id="results-empty-state" class="results-empty-state">
                            <svg class="empty-state-icon" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"> <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 16.5h16.5M3.75 8.25h16.5M3.75 4.5h16.5" /> </svg>
                            <h3 data-i18n="resultsTitleDefault">Select a group</h3>
                            <p id="results-placeholder" data-i18n="resultsSelectPrompt">Select a group from the list to view its details.</p>
                        </div>

                        <!-- 4. Tabbed Content -->
                        <div id="results-content" class="hidden">
                            <!-- Tab Navigation -->
                            <div class="tabs-nav-wrapper">
                                <nav class="tabs-nav" aria-label="Tabs">
                                    <button id="tab-btn-results" class="tab-btn active" data-i18n="tabResults">Results</button>
                                    <button id="tab-btn-roster" class="tab-btn" data-i18n="tabRoster">Student Roster</button>
                                </nav>
                            </div>

                            <!-- Tab Panels -->
                            <div id="tab-panel-results" class="tab-panel">
                                <div id="results-container" class="results-container">
                                    <p id="results-none-msg" class="results-none-msg hidden" data-i18n="resultsNone"></p>
                                    <table id="results-table" class="hidden results-table">
                                        <thead>
                                            <tr>
                                                <th scope="col" data-i18n="tableStudent">Student</th>
                                                <th scope="col" data-i18n="tableTest">Test ID</th>
                                                <th scope="col" data-i18n="tableScore">Score</th>
                                                <th scope="col" data-i18n="tableTime">Time</th>
                                                <th scope="col" data-i18n="tableDate">Date</th>
                                                <th scope="col"> <span class="sr-only" data-i18n="tableViewSr">View</span> </th>
                                            </tr>
                                        </thead>
                                        <tbody id="results-table-body"></tbody>
                                    </table>
                                </div>
                            </div>
                            <div id="tab-panel-roster" class="tab-panel hidden">
                                <div id="roster-container">
                                    <h3 class="sr-only" data-i18n="rosterTitle">Student Roster</h3>
                                    <div id="roster-list" class="roster-list">
                                        <span id="roster-none-msg" class="text-slate-500 italic hidden" data-i18n="rosterNone"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>
</main>

<div id="notification-toast"> <span id="notification-message"></span> </div>

<div id="create-group-modal-overlay" class="modal-overlay hidden"> 
    <div id="create-group-modal-content" class="modal-content">
        <button id="create-group-modal-close-btn" class="modal-close-btn">&times;</button>
        <h2 data-i18n="groupsCreateTitle">Create New Group</h2>
        <form id="create-group-form">
            <div>
                <label for="group-name-input" class="modal-label" data-i18n="groupsCreateLabel">Group Name</label>
                <input type="text" id="group-name-input" class="input-field" placeholder="e.g. Algebra 1 (Fall)" required>
            </div>
            <button type="submit" id="create-group-submit-btn" class="thelo-btn"> <span data-i18n="groupsCreateButton">Create Group</span> </button>
        </form>
    </div>
</div>

<div id="result-modal-overlay" class="modal-overlay hidden">
    <div id="result-modal-content" class="modal-content">
        <button id="modal-close-btn" class="modal-close-btn">&times;</button>
        <h2 id="modal-title" data-i18n="modalTestDetailsTitle">Test Result Details</h2>
        <div class="modal-header-grid">
            <div> <span class="question-label" data-i18n="modalLabelStudent">Student</span> <span id="modal-student-email"></span> </div>
            <div> <span class="question-label" data-i18n="modalLabelTestID">Test ID</span> <span id="modal-test-id"></span> </div>
            <div> <span class="question-label" data-i18n="modalLabelScore">Score</span> <span id="modal-score"></span> </div>
            <div> <span class="question-label" data-i18n="modalLabelTime">Time Taken</span> <span id="modal-time"></span> </div>
        </div>
        <div id="modal-results-container" class="modal-results-container"></div>
    </div>
</div>


<script type="module">
    // Firebase SDK imports...
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, collection, query, where, getDocs, addDoc, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // Firebase Config...
    const firebaseConfig = { apiKey: "AIzaSyAbnPpcIt88B0jIAoLUdC71zmQDvR_fdu8", authDomain: "physmathacademy-722b3.firebaseapp.com", projectId: "physmathacademy-722b3", appId: "1:1093640992262:web:35b1bf4d2364bcf745f587" };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    try { setLogLevel('debug'); } catch (e) { console.warn("Could not set Firestore log level:", e); }

    // DOM Elements...
    const loadingState = document.getElementById('loading-state');
    const errorState = document.getElementById('error-state');
    const dashboardContent = document.getElementById('dashboard-content');
    const welcomeMessage = document.getElementById('welcome-message');
    const logoutBtn = document.getElementById('logout-btn');
    const langEnBtn = document.getElementById('lang-en');
    const langHyBtn = document.getElementById('lang-hy');
    // NEW Group Pill Selection Elements
    const groupSelectionContainer = document.getElementById('group-selection-container');
    const noGroupsMsg = document.getElementById('no-groups-msg');
    // Content Panel
    const resultsTitle = document.getElementById('results-title');
    const resultsEmptyState = document.getElementById('results-empty-state');
    const resultsContent = document.getElementById('results-content');
    const tabBtnResults = document.getElementById('tab-btn-results');
    const tabBtnRoster = document.getElementById('tab-btn-roster');
    const tabPanelResults = document.getElementById('tab-panel-results');
    const tabPanelRoster = document.getElementById('tab-panel-roster');
    const resultsContainer = document.getElementById('results-container');
    const resultsNoneMsg = document.getElementById('results-none-msg');
    const resultsTable = document.getElementById('results-table');
    const resultsTableBody = document.getElementById('results-table-body');
    const rosterContainer = document.getElementById('roster-container');
    const rosterList = document.getElementById('roster-list');
    const rosterNoneMsg = document.getElementById('roster-none-msg');
    const resultsPlaceholder = document.getElementById('results-placeholder');
    // Modals
    const navCreateGroupBtn = document.getElementById('nav-create-group-btn');
    const navCreateGroupBtnMobile = document.getElementById('nav-create-group-btn-mobile');
    const createGroupModalOverlay = document.getElementById('create-group-modal-overlay');
    const createGroupModalCloseBtn = document.getElementById('create-group-modal-close-btn');
    const createGroupForm = document.getElementById('create-group-form');
    const groupNameInput = document.getElementById('group-name-input');
    const createGroupSubmitBtn = document.getElementById('create-group-submit-btn');
    const resultModalOverlay = document.getElementById('result-modal-overlay');
    const modalCloseBtn = document.getElementById('modal-close-btn');
    const modalStudentEmail = document.getElementById('modal-student-email');
    const modalTestId = document.getElementById('modal-test-id');
    const modalScore = document.getElementById('modal-score');
    const modalTime = document.getElementById('modal-time');
    const modalResultsContainer = document.getElementById('modal-results-container');

    // App State...
    let currentUser = null;
    let currentTutor = null;
    let selectedGroupId = null;
    let currentLang = localStorage.getItem('thelo-lang') || 'en';
    let allGroups = []; 

    // UI Strings (i18n)...
    const strings = {
        en: {
            title: 'Tutor Dashboard | thelo', navTutorPortal: 'Tutor Portal', navLogout: 'Log Out', navCreateGroup: 'Create Group', navCreateGroupShort: 'New', loading: 'Loading Dashboard...', loadingSubmit: 'Creating...', errorTitle: 'Access Denied', errorSubtitle: 'You must be a registered tutor to access this page. Please contact support if you believe this is an error.', errorButton: 'Back to Home', dashboardTitle: 'Tutor Dashboard', dashboardSubtitle: 'Welcome. Select a group to get started.', groupsTitle: 'My Groups', groupsSelectDefault: 'Select a group...', groupsNone: "You haven't created any groups yet.", groupsCreateTitle: 'Create New Group', groupsCreateLabel: 'Group Name', groupsCreateButton: 'Create Group', groupsCreateSuccess: 'Group "{groupName}" created! Join Code: {joinCode}', groupsCreateError: 'Error creating group. Please try again.', joinCode: 'Join Code', resultsTitleDefault: 'Select a group', resultsSelectPrompt: 'Select a group from the list to view its details.', resultsTitleLoading: 'Loading results for "{groupName}"...', resultsTitleLoaded: 'Showing results for "{groupName}"', resultsNone: 'No test results found for this group yet.', rosterTitle: 'Student Roster', rosterNone: 'No students have joined this group yet.', tabResults: 'Results', tabRoster: 'Student Roster', tableStudent: 'Student', tableTest: 'Test ID', tableScore: 'Score', tableTime: 'Time', tableDate: 'Date', tableTimeValue: '{time}s', tableView: 'View', tableViewSr: 'View Details', modalTestDetailsTitle: 'Test Result Details', modalLabelStudent: 'Student', modalLabelTestID: 'Test ID', modalLabelScore: 'Score', modalLabelTime: 'Time Taken', statusCorrect: 'Correct', statusIncorrect: 'Incorrect', modalQuestionTitle: 'Question {index}', modalLabelSolution: "Student's Solution", modalLabelFeedback: 'AI Feedback'
        },
        hy: {
            title: 'Ուսուցչի Վահանակ | Թելո', navTutorPortal: 'Ուսուցչի Վահանակ', navLogout: 'Դուրս գալ', navCreateGroup: 'Ստեղծել Խումբ', navCreateGroupShort: 'Նոր', loading: 'Բեռնվում է...', loadingSubmit: 'Ստեղծվում է...', errorTitle: 'Մուտքը մերժված է', errorSubtitle: 'Դուք պետք է լինեք գրանցված ուսուցիչ՝ այս էջը տեսնելու համար։', errorButton: 'Գլխավոր էջ', dashboardTitle: 'Ուսուցչի Վահանակ', dashboardSubtitle: 'Բարի գալուստ։ Ընտրեք խումբ՝ սկսելու համար։', groupsTitle: 'Իմ Խմբերը', groupsSelectDefault: 'Ընտրեք խումբ...', groupsNone: 'Դուք դեռ խմբեր չեք ստեղծել։', groupsCreateTitle: 'Ստեղծել Նոր Խումբ', groupsCreateLabel: 'Խմբի Անունը', groupsCreateButton: 'Ստեղծել Խումբ', groupsCreateSuccess: '«{groupName}» խումբը ստեղծված է։ Միանալու կոդը՝ {joinCode}', groupsCreateError: 'Սխալ՝ խումբ ստեղծելիս։ Խնդրում ենք փորձել նորից։', joinCode: 'Միանալու կոդ', resultsTitleDefault: 'Ընտրեք խումբ', resultsSelectPrompt: 'Ընտրեք խումբ ցանկից՝ մանրամասները տեսնելու համար։', resultsTitleLoading: 'Բեռնվում են «{groupName}» խմբի արդյունքները...', resultsTitleLoaded: '«{groupName}» խմբի արդյունքները', resultsNone: 'Այս խմբի համար թեստի արդյունքներ դեռ չկան։', rosterTitle: 'Աշակերտների Ցուցակ', rosterNone: 'Այս խմբին դեռ ոչ մի աշակերտ չի միացել։', tabResults: 'Արդյունքներ', tabRoster: 'Աշակերտների Ցուցակ', tableStudent: 'Աշակերտ', tableTest: 'Թեստի ID', tableScore: 'Միավոր', tableTime: 'Ժամանակ', tableDate: 'Ամսաթիվ', tableTimeValue: '{time}վ', tableView: 'Դիտել', tableViewSr: 'Դիտել Մանրամասները', modalTestDetailsTitle: 'Թեստի Արդյունքների Մանրամասներ', modalLabelStudent: 'Աշակերտ', modalLabelTestID: 'Թեստի ID', modalLabelScore: 'Միավոր', modalLabelTime: 'Ծախսած Ժամանակ', statusCorrect: 'Ճիշտ է', statusIncorrect: 'Սխալ է', modalQuestionTitle: 'Հարց {index}', modalLabelSolution: 'Աշակերտի Լուծումը', modalLabelFeedback: 'AI-ի Կարծիքը'
        }
    };

    /** Shows notification toast */
    function showNotification(message, isError = false) {
        const toast = document.getElementById('notification-toast');
        const msgEl = document.getElementById('notification-message');
        if (!toast || !msgEl) return;
        msgEl.textContent = message;
        toast.classList.toggle('error', isError);
        toast.classList.remove('hidden');
        requestAnimationFrame(() => { toast.classList.add('show'); });
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => { toast.classList.add('hidden'); toast.classList.remove('error'); }, 300); 
        }, 3000);
    }

    /** Applies UI text based on language */
    function applyContent(lang) {
        const T = strings[lang];
        if (!T) return;
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.dataset.i18n;
            if (T[key]) { el.innerHTML = T[key]; }
        });
        document.documentElement.lang = lang;
        langEnBtn.classList.toggle('active', lang === 'en');
        langHyBtn.classList.toggle('active', lang === 'hy');
       
        groupNameInput.placeholder = (lang === 'hy') ? 'օր.՝ Հանրահաշիվ 1 (Աշուն)' : 'e.g. Algebra 1 (Fall)';
        resultsNoneMsg.textContent = T.resultsNone;
        rosterNoneMsg.textContent = T.rosterNone;
        if (resultsPlaceholder) resultsPlaceholder.textContent = T.resultsSelectPrompt;
       
        const defaultTitleEls = document.querySelectorAll('[data-i18n="resultsTitleDefault"]');
        defaultTitleEls.forEach(el => el.textContent = T.resultsTitleDefault);
        if (!selectedGroupId) resultsTitle.textContent = T.resultsTitleDefault;

        // Removed selectedGroupText logic

        const tableHeaders = resultsTable.querySelectorAll('thead th[data-i18n]');
        tableHeaders.forEach(th => {
            const key = th.dataset.i18n;
             if (T[key]) { th.textContent = T[key]; }
        });
        const srViewHeader = resultsTable.querySelector('thead th span[data-i18n="tableViewSr"]');
         if (srViewHeader && T.tableViewSr) { srViewHeader.textContent = T.tableViewSr; }
    }

    /** Formats string with values */
    function formatString(str, values) { return str.replace(/{(\w+)}/g, (match, key) => values[key] || match); }

    /** Auth state change handler */
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            console.log("Auth state changed. User is present:", user.email);
            currentUser = user;
            try {
                const tutorDocRef = doc(db, "tutors", user.email);
                const tutorDoc = await getDoc(tutorDocRef);
                if (tutorDoc.exists()) {
                    currentTutor = { email: user.email, uid: user.uid, ...tutorDoc.data() };
                    await initDashboard();
                } else { console.warn("User is not listed:", user.email); showErrorState(); }
            } catch (err) { console.error("Error checking tutor:", err); showErrorState(); }
        } else { window.location.href = '/auth'; }
    });

    /** Shows error state */
    function showErrorState() { loadingState.classList.add('hidden'); errorState.classList.remove('hidden'); }

    /** Initializes dashboard */
    async function initDashboard() {
        loadingState.classList.add('hidden');
        dashboardContent.classList.remove('hidden');
        const T = strings[currentLang];
        welcomeMessage.textContent = formatString(T.dashboardSubtitle, { tutorEmail: currentTutor.email });
        applyContent(currentLang);
        setupEventListeners(); await loadGroups();
    }

    /** Sets up event listeners */
    function setupEventListeners() {
        logoutBtn.addEventListener('click', handleLogout);
        langEnBtn.addEventListener('click', () => switchLanguage('en'));
        langHyBtn.addEventListener('click', () => switchLanguage('hy'));
        navCreateGroupBtn.addEventListener('click', showCreateGroupModal);
        navCreateGroupBtnMobile.addEventListener('click', showCreateGroupModal);
        createGroupModalCloseBtn.addEventListener('click', hideCreateGroupModal);
        createGroupModalOverlay.addEventListener('click', (e) => { if (e.target === createGroupModalOverlay) hideCreateGroupModal(); });
        createGroupForm.addEventListener('submit', handleCreateGroup);
        tabBtnResults.addEventListener('click', () => switchTab('results'));
        tabBtnRoster.addEventListener('click', () => switchTab('roster'));
        resultModalOverlay.addEventListener('click', (e) => { if (e.target === resultModalOverlay) hideResultDetail(); });
        modalCloseBtn.addEventListener('click', hideResultDetail);
        // Removed dropdown listeners
    }
   
    /** Switches active language */
    function switchLanguage(lang) {
        currentLang = lang;
        localStorage.setItem('thelo-lang', currentLang);
        applyContent(currentLang); // Apply text first
        loadGroups(selectedGroupId); // Reload groups pills with new lang
       
        // If a group is selected, reload its data to update table dates/text
        if (selectedGroupId) {
            const selectedGroup = allGroups.find(g => g.id === selectedGroupId);
            if (selectedGroup) {
                loadGroupData(selectedGroup); // Reload table data etc.
            } else {
                 showEmptyState();
            }
        }
    }

    /** Switches active tab */
    function switchTab(tabId) {
        const isActive = tabId === 'results';
        tabBtnResults.classList.toggle('active', isActive);
        tabPanelResults.classList.toggle('hidden', !isActive);
        tabBtnRoster.classList.toggle('active', !isActive);
        tabPanelRoster.classList.toggle('hidden', isActive);
    }
   
    /** Handles group selection from pill buttons */
    function handleGroupSelect(groupId) {
        // If clicking the same active group, deselect it
        if (groupId === selectedGroupId) {
            selectedGroupId = null;
        } else {
            selectedGroupId = groupId;
        }

        // Update visual state of all pills
        document.querySelectorAll('.group-pill-btn').forEach(item => {
            item.classList.toggle('active', item.dataset.groupId === selectedGroupId);
        });

        if (!selectedGroupId) {
            showEmptyState();
            return;
        }
        
        const selectedGroup = allGroups.find(g => g.id === selectedGroupId);
        if (selectedGroup) {
            loadGroupData(selectedGroup);
        }
    }

    /** Resets the main panel to empty state */
    function showEmptyState() {
        const T = strings[currentLang];
        resultsTitle.textContent = T.resultsTitleDefault;
        resultsEmptyState.classList.remove('hidden');
        resultsContent.classList.add('hidden');
    }

    /** Logs the user out */
    async function handleLogout(e) { e.preventDefault(); try { await signOut(auth); window.location.href = '/'; } catch (err) { console.error("Error logging out:", err); } }

    /** Loads groups into the pill container */
    async function loadGroups(preserveSelected = null) {
        allGroups = []; 
        const T = strings[currentLang];
        groupSelectionContainer.innerHTML = ''; // Clear pill container
       
        const q = query(collection(db, "groups"), where("ownerId", "==", currentUser.uid));
        try {
            const querySnapshot = await getDocs(q);
            if (querySnapshot.empty) {
                noGroupsMsg.classList.remove('hidden'); 
                groupSelectionContainer.classList.add('hidden'); 
                showEmptyState(); 
                return;
            }
           
            noGroupsMsg.classList.add('hidden'); 
            groupSelectionContainer.classList.remove('hidden'); 
           
            const groups = [];
            querySnapshot.forEach(doc => groups.push({ id: doc.id, ...doc.data() }));
            groups.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));

            let isPreservedSelected = preserveSelected && groups.some(g => g.id === preserveSelected);

            groups.forEach(group => {
                allGroups.push(group); // Keep track of all groups
                const item = document.createElement('button');
                item.className = 'thelo-btn-secondary'; // Use the same class as "Create Group"
                item.dataset.groupId = group.id;
                item.textContent = `${group.groupName} (Code: ${group.joinCode})`;
                item.classList.toggle('active', preserveSelected === group.id);
                item.onclick = () => handleGroupSelect(group.id);
                groupSelectionContainer.appendChild(item);
            });

            if (isPreservedSelected) {
                 selectedGroupId = preserveSelected; 
            } else {
                 selectedGroupId = null; 
                 if (!preserveSelected) showEmptyState(); 
            }

        } catch (err) { console.error("Error loading groups:", err); noGroupsMsg.textContent = "Error loading groups."; noGroupsMsg.classList.remove('hidden'); }
    }

    /** Generates join code */
    function generateJoinCode() { const chars = 'ABCDEFGHIJKLMNPQRSTUVWXYZ123456789'; let r = ''; for (let i = 0; i < 6; i++) r += chars.charAt(Math.floor(Math.random() * chars.length)); return r; }
    /** Shows create group modal */
    function showCreateGroupModal() { createGroupModalOverlay.classList.remove('hidden'); setTimeout(() => createGroupModalOverlay.classList.add('show'), 10); }
    /** Hides create group modal */
    function hideCreateGroupModal() { createGroupModalOverlay.classList.remove('show'); setTimeout(() => createGroupModalOverlay.classList.add('hidden'), 300); }

    /** Handles create group form submission */
    async function handleCreateGroup(e) {
        e.preventDefault();
        const groupName = groupNameInput.value.trim();
        if (!groupName) return;
       
        createGroupSubmitBtn.disabled = true;
        const T = strings[currentLang];
        createGroupSubmitBtn.querySelector('span').textContent = T.loadingSubmit; 
       
        const newGroup = { groupName, ownerId: currentUser.uid, ownerEmail: currentUser.email, joinCode: generateJoinCode(), createdAt: serverTimestamp(), memberIds: [] };
        try {
            const docRef = await addDoc(collection(db, "groups"), newGroup);
            showNotification(formatString(T.groupsCreateSuccess, { groupName: newGroup.groupName, joinCode: newGroup.joinCode }));
            groupNameInput.value = '';
            hideCreateGroupModal();
            await loadGroups(docRef.id); 
            handleGroupSelect(docRef.id); 

        } catch (err) { console.error("Error creating group:", err); showNotification(T.groupsCreateError, true);
        } finally { createGroupSubmitBtn.disabled = false; createGroupSubmitBtn.querySelector('span').textContent = T.groupsCreateButton; }
    }

   /** Shows result detail modal */
   async function showResultDetail(result) {
        const T = strings[currentLang];
        modalStudentEmail.textContent = result.email; modalTestId.textContent = result.testId; modalScore.textContent = `${result.score} / ${result.totalQuestions}`; modalTime.textContent = formatString(T.tableTimeValue, { time: result.timeTakenSeconds }); modalResultsContainer.innerHTML = '<p>Loading details...</p>'; 
        try {
            const detailQuery = query(collection(db, "thelo-test-results", result.id, "results"));
            const detailSnapshot = await getDocs(detailQuery);
            if (detailSnapshot.empty) { modalResultsContainer.innerHTML = '<p>No detailed breakdown available.</p>'; } else {
                modalResultsContainer.innerHTML = ''; const questions = [];
                detailSnapshot.forEach(doc => questions.push({ id: doc.id, ...doc.data() }));
                questions.sort((a, b) => parseInt(a.id) - parseInt(b.id));
                questions.forEach((q, index) => {
                    let statusClass = 'question-status-other', statusText = q.status || 'N/A';
                    if (q.status === 'correct') { statusClass = 'question-status-correct'; statusText = T.statusCorrect; } 
                    else if (q.status === 'incorrect') { statusClass = 'question-status-incorrect'; statusText = T.statusIncorrect; }
                    const questionEl = document.createElement('div'); questionEl.className = 'question-item'; 
                    questionEl.innerHTML = `<div class="question-header"><span class="question-title">${formatString(T.modalQuestionTitle, { index: index + 1 })}</span><span class="${statusClass}">${statusText}</span></div><div class="question-body"><div class="lg:col-span-2"><span class="question-label">${T.modalLabelSolution}</span><img src="${q.solutionImage}" alt="Student solution for question ${index + 1}" class="student-solution-img"></div><div class="lg:col-span-3"><span class="question-label">${T.modalLabelFeedback}</span><div class="feedback-text"><p>${q.feedback || 'No feedback provided.'}</p><p class="mt-2 text-xs"><strong>Question:</strong> ${q.question || 'N/A'}</p><p class="mt-2 text-xs"><strong>Correct Answer:</strong> ${q.correctAnswer || 'N/A'}</p></div></div></div>`;
                    modalResultsContainer.appendChild(questionEl);
                });
            }
        } catch (err) { console.error("Error loading result details:", err); modalResultsContainer.innerHTML = '<p class="text-red-500">Error loading details.</p>'; }
        resultModalOverlay.classList.remove('hidden'); setTimeout(() => resultModalOverlay.classList.add('show'), 10);
    }

    /** Hides result detail modal */
    function hideResultDetail() { resultModalOverlay.classList.remove('show'); setTimeout(() => { resultModalOverlay.classList.add('hidden'); }, 300); }

    /** Loads data for the selected group */
    async function loadGroupData(group) {
        const T = strings[currentLang]; // Get current language strings
        resultsTitle.textContent = formatString(T.resultsTitleLoading, { groupName: group.groupName });
        resultsEmptyState.classList.add('hidden'); resultsContent.classList.remove('hidden'); switchTab('results'); 
        resultsTable.classList.add('hidden'); resultsNoneMsg.classList.add('hidden'); resultsTableBody.innerHTML = ''; rosterList.innerHTML = ''; rosterNoneMsg.classList.add('hidden');
        try {
            const studentsQuery = query(collection(db, "thelo-students"), where("groupId", "==", group.id));
            const studentSnapshot = await getDocs(studentsQuery);
            rosterList.innerHTML = ''; 
            if (studentSnapshot.empty) { rosterList.appendChild(rosterNoneMsg); rosterNoneMsg.classList.remove('hidden'); } else {
                studentSnapshot.forEach(doc => { const el = document.createElement('span'); el.className = 'block text-sm text-slate-700'; el.textContent = doc.data().email; rosterList.appendChild(el); });
            }
            const resultsQuery = query(collection(db, "thelo-test-results"), where("groupId", "==", group.id));
            const resultsSnapshot = await getDocs(resultsQuery);
            resultsTableBody.innerHTML = ''; 
            if (resultsSnapshot.empty) { resultsNoneMsg.classList.remove('hidden'); resultsTable.classList.add('hidden'); } else {
                resultsNoneMsg.classList.add('hidden'); const results = [];
                resultsSnapshot.forEach(doc => results.push({ id: doc.id, ...doc.data() }));
                results.sort((a, b) => (b.submittedAt?.seconds || 0) - (a.submittedAt?.seconds || 0));
                results.forEach(result => renderResultRow(result)); // Pass result to render function
                resultsTable.classList.remove('hidden');
            }
            resultsTitle.textContent = formatString(T.resultsTitleLoaded, { groupName: group.groupName });
        } catch (err) { console.error("Error loading group data:", err); resultsTitle.textContent = "Error loading data"; resultsNoneMsg.textContent = "Error loading results."; resultsNoneMsg.classList.remove('hidden'); }
    }

    /** Renders a single result row */
    function renderResultRow(result) {
        const T = strings[currentLang]; // **Ensure T uses currentLang**
        const row = document.createElement('tr'); row.className = 'hover:bg-slate-50';
        const scoreText = `${result.score} / ${result.totalQuestions}`;
        const timeText = formatString(T.tableTimeValue, { time: result.timeTakenSeconds });
        const dateText = result.submittedAt ? result.submittedAt.toDate().toLocaleString(currentLang.startsWith('hy') ? 'hy-AM' : 'en-US') : 'N/A';
        // **Use T.tableView directly here**
        row.innerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">${result.email}</td> <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600">${result.testId}</td> <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600">${scoreText}</td> <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600">${timeText}</td> <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600">${dateText}</td> <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"> <button class="thelo-btn-secondary-sm view-details-btn">${T.tableView}</button> </td>`;
        row.querySelector('.view-details-btn').addEventListener('click', async (e) => { e.preventDefault(); await showResultDetail(result); });
        resultsTableBody.appendChild(row);
    }

    // Initial language setup
    applyContent(currentLang);

</script>

</body>
</html>
