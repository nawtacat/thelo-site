<!DOCTYPE html>  
<html lang="en">  
<head>  
  <meta charset="UTF-8" />  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />  
  <title>thelo – Auth</title>  
  <link rel="icon" href="https://thelo.space/img/thelofavicon.png" type="image/png" />  

    <link rel="preconnect" href="https://fonts.googleapis.com">  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>  
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;700;800&family=Noto+Serif+Armenian:wght@400;700&display=swap" rel="stylesheet">  

    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>  

  <style>  
      :root {  
          --thelo-blue:#2563EB;  
          --thelo-bg:#F8F9FA;  
          --thelo-text:#111827;  
          --grid-color:#E5E7EB;  
      }  
      body{  
          font-family:'Manrope',system-ui,-apple-system,'Segoe UI','Helvetica Neue',Arial,sans-serif;  
          background-color:var(--thelo-bg);  
          color:var(--thelo-text);  
          background-image:linear-gradient(to right,var(--grid-color) 1px,transparent 1px),linear-gradient(to bottom,var(--grid-color) 1px,transparent 1px);  
          background-size:40px 40px;  
          /* Ensure body is a flex container for centering content */
          display: flex;
          align-items: center;
          justify-content: center;
          min-height: 100vh;
      }  
      html[lang="hy"] body{font-family:'Noto Serif Armenian',serif;}  
      .window-container{background:#fff;border:1px solid var(--grid-color);border-radius:.75rem;padding:2.5rem;box-shadow:0 10px 15px -3px rgb(0 0 0/.1),0 4px 6px -4px rgb(0 0 0/.1);position:relative;}  
      .window-container::before{content:" ";position:absolute;top:1rem;left:1rem;width:52px;height:12px;background-image:url("data:image/svg+xml,%3Csvg width='52' height='12' viewBox='0 0 52 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='6' cy='6' r='6' fill='%23FF5F56'/%3E%3Ccircle cx='26' cy='6' r='6' fill='%23FFBD2E'/%3E%3Ccircle cx='46' cy='6' r='6' fill='%2327C93F'/%3E%3C/svg%3E");}  

      /* New styles for profile photo upload */
      .profile-photo-upload-wrap {
          display: flex;
          flex-direction: column;
          align-items: center;
          margin-bottom: 1rem; /* Adjust spacing as needed */
      }
      .profile-photo-preview {
          width: 96px; /* Example size, adjust as needed */
          height: 96px; /* Example size, adjust as needed */
          border-radius: 50%;
          object-fit: cover;
          border: 2px solid var(--thelo-blue); /* Theme color border */
          margin-bottom: 0.75rem;
      }
      .profile-photo-label {
          cursor: pointer;
          font-weight: 700;
          color: var(--thelo-blue);
          text-decoration: underline;
      }
      .profile-photo-input {
          display: none; /* Hide the default file input */
      }

      /* Responsive adjustments for mobile to maintain visual integrity */
      @media (max-width: 767px) {
          .window-container {
              padding: 1.5rem; /* Smaller padding on mobile */
          }
          .window-container::before {
              top: 0.75rem;
              left: 0.75rem;
              transform: scale(0.8);
              transform-origin: top left;
          }
          .profile-photo-preview {
              width: 80px; /* Smaller on mobile */
              height: 80px;
          }
      }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center px-6">
    <a href="/" class="fixed top-4 left-4 text-sm font-semibold text-slate-500 hover:text-[var(--thelo-blue)]"><span id="homeArrow">←</span> <span id="homeLink">Home</span></a>
  <button id="langToggle" class="fixed top-4 right-4 rounded-md border border-slate-300 px-3 py-1 text-xs font-semibold text-slate-600 hover:bg-slate-100">Հայ</button>

    <div class="window-container w-full max-w-md">
      <h2 id="formTitle" class="text-2xl font-extrabold mb-6 text-center">Sign In</h2>
      <p class="text-center text-sm mb-4">
          <span id="togglePrompt">Don't have an account?</span>
          <button id="toggleLink" class="text-[var(--thelo-blue)] font-semibold hover:underline">Create one</button>
      </p>

      <form id="authForm" class="grid gap-y-4">
            <div id="profilePhotoWrap" class="profile-photo-upload-wrap hidden">
                <img id="profilePhotoPreview" class="profile-photo-preview" src="https://via.placeholder.com/96/E5E7EB/6B7280?text=+" alt="Profile Preview">
                <label for="profilePhotoInput" class="profile-photo-label" id="labelUploadPhoto">Upload Photo</label>
                <input type="file" id="profilePhotoInput" accept="image/*" class="profile-photo-input">
            </div>

          <div>
              <label id="labelEmail" class="block text-sm font-bold mb-1" for="email">Email</label>
              <input id="email" type="email" required class="w-full rounded-lg border border-slate-300 bg-white px-4 py-3 shadow-sm focus:border-[var(--thelo-blue)] focus:ring-2 focus:ring-[var(--thelo-blue)]/50" />
          </div>
          <div>
              <label id="labelPassword" class="block text-sm font-bold mb-1" for="password">Password</label>
              <input id="password" type="password" required class="w-full rounded-lg border border-slate-300 bg-white px-4 py-3 shadow-sm focus:border-[var(--thelo-blue)] focus:ring-2 focus:ring-[var(--thelo-blue)]/50" />
          </div>
          <div id="confirmWrap" class="hidden">
              <label id="labelConfirm" class="block text-sm font-bold mb-1" for="confirm">Confirm Password</label>
              <input id="confirm" type="password" class="w-full rounded-lg border border-slate-300 bg-white px-4 py-3 shadow-sm focus:border-[var(--thelo-blue)] focus:ring-2 focus:ring-[var(--thelo-blue)]/50" />
          </div>
          <div id="roleWrap" class="hidden">
              <label id="labelRole" class="block text-sm font-bold mb-1" for="roleSelect">I am a:</label>
              <select id="roleSelect" name="role" class="mt-1 block w-full rounded-lg border border-slate-300 bg-white px-4 py-3 shadow-sm focus:border-[var(--thelo-blue)] focus:ring-2 focus:ring-[var(--thelo-blue)]/50">
                  <option value="student" id="optStudent">Student</option>
                  <option value="teacher" id="optTeacher">Teacher</option>
              </select>
          </div>
          <button id="submitBtn" type="submit" class="mt-2 rounded-lg bg-[var(--thelo-blue)] px-8 py-3 font-bold text-white shadow hover:scale-105 transition-transform">Sign In</button>
      </form>
      <p id="toast" class="mt-6 text-center text-sm text-red-600 hidden"></p>
  </div>

    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    // You'll need to enable Firebase Storage and Firestore imports
    // import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";
    // import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";


    const firebaseConfig = {
      apiKey:"AIzaSyAbnPpcIt88B0jIAoLUdC71zmQDvR_fdu8",
      authDomain:"physmathacademy-722b3.firebaseapp.com",
      projectId:"physmathacademy-722b3",
      appId:"1:1093640992262:web:35b1bf4d2364bcf745f587"
    };
    const app=initializeApp(firebaseConfig);
    const auth=getAuth(app);
    // You'll need to enable Firebase Storage and Firestore initialization
    // const storage = getStorage(app);
    // const db = getFirestore(app);

    /* === i18n === */
    const TXT={
      en:{
          home:"Home",
          signInTitle:"Sign In",
          signUpTitle:"Create Account",
          signInBtn:"Sign In",
          signUpBtn:"Create Account",
          toggleHave:"Don't have an account?",
          toggleHas:"Already have one?",
          toggleCreate:"Create one",
          toggleSignin:"Sign in",
          email:"Email",
          password:"Password",
          confirm:"Confirm Password",
          roleLabel:"I am a:",
          student:"Student",
          teacher:"Teacher",
          mismatch:"Passwords do not match",
          uploadPhoto:"Upload Photo", // New string for photo upload label
          // These strings related to actual upload success/error are for full Firebase Storage integration
          // uploadingPhoto:"Uploading Photo...", 
          // signupSuccess:"Account created! Redirecting...", 
          // errorUpload:"Failed to upload photo." 
      },
      hy:{
          home:"Գլխավոր",
          signInTitle:"Մուտք",
          signUpTitle:"Ստեղծել հաշիվ",
          signInBtn:"Մուտք",
          signUpBtn:"Ստեղծել",
          toggleHave:"Չունե՞ք հաշիվ?",
          toggleHas:"Արդեն ունե՞ք հաշիվ?",
          toggleCreate:"Ստեղծել",
          toggleSignin:"Մուտք",
          email:"Էլ‑փոստ",
          password:"Գաղտնաբառ",
          confirm:"Կրկնել գաղտնաբառը",
          roleLabel:"Ես՝",
          student:"Ուսանող եմ",
          teacher:"Ուսուցիչ եմ",
          mismatch:"Գաղտնաբառերը չեն համընկնում",
          uploadPhoto:"Ներբեռնել լուսանկար", // New Armenian string
          // uploadingPhoto:"Լուսանկարը ներբեռնվում է...", 
          // signupSuccess:"Հաշիվը ստեղծված է։ Վերահղում...", 
          // errorUpload:"Լուսանկարը չհաջողվեց ներբեռնել։" 
      }
    };

    let lang='en';
    let mode='signin';
    let selectedFile = null; // To store the selected image file

    /* === DOM === */
    const langBtn=document.getElementById('langToggle');
    const homeLink=document.getElementById('homeLink');
    const formTitle=document.getElementById('formTitle');
    const togglePrompt=document.getElementById('togglePrompt');
    const toggleLink=document.getElementById('toggleLink');
    const labelEmail=document.getElementById('labelEmail');
    const labelPassword=document.getElementById('labelPassword');
    const labelConfirm=document.getElementById('labelConfirm');
    const labelRole=document.getElementById('labelRole');
    const labelUploadPhoto = document.getElementById('labelUploadPhoto'); // New
    const optStudent=document.getElementById('optStudent');
    const optTeacher=document.getElementById('optTeacher');
    const confirmWrap=document.getElementById('confirmWrap');
    const roleWrap=document.getElementById('roleWrap');
    const profilePhotoWrap = document.getElementById('profilePhotoWrap'); // New
    const profilePhotoPreview = document.getElementById('profilePhotoPreview'); // New
    const profilePhotoInput = document.getElementById('profilePhotoInput'); // New
    const submitBtn=document.getElementById('submitBtn');
    const toast=document.getElementById('toast');

    function applyLang(){
      const s=TXT[lang];
      document.documentElement.lang=lang;
      langBtn.textContent=lang==='en'?'Հայ':'EN';
      homeLink.textContent=s.home;
      labelEmail.textContent=s.email;
      labelPassword.textContent=s.password;
      labelConfirm.textContent=s.confirm;
      labelRole.textContent=s.roleLabel;
      labelUploadPhoto.textContent = s.uploadPhoto; // Apply new string
      optStudent.textContent=s.student;
      optTeacher.textContent=s.teacher;
      if(mode==='signup'){
        formTitle.textContent=s.signUpTitle;
        togglePrompt.textContent=s.toggleHas;
        toggleLink.textContent=s.toggleSignin;
        submitBtn.textContent=s.signUpBtn;
      }else{
        formTitle.textContent=s.signInTitle;
        togglePrompt.textContent=s.toggleHave;
        toggleLink.textContent=s.toggleCreate;
        submitBtn.textContent=s.signInBtn;
      }
    }

    function setMode(m){
      mode=m;
      if(m==='signup'){
            profilePhotoWrap.classList.remove('hidden'); // Show photo upload
          confirmWrap.classList.remove('hidden');
          roleWrap.classList.remove('hidden');
      }else{
            profilePhotoWrap.classList.add('hidden'); // Hide photo upload
          confirmWrap.classList.add('hidden');
          roleWrap.classList.add('hidden');
            // Reset photo preview and selected file on mode change
            profilePhotoPreview.src = "https://via.placeholder.com/96/E5E7EB/6B7280?text=+"; // Placeholder for no image
            selectedFile = null;
      }
      applyLang();
    }

    langBtn.addEventListener('click',()=>{lang=lang==='en'?'hy':'en';applyLang();});
    toggleLink.addEventListener('click',()=>{setMode(mode==='signin'?'signup':'signin');});

    // Handle profile photo selection and preview
    profilePhotoInput.addEventListener('change', (e) => {
        selectedFile = e.target.files[0];
        if (selectedFile) {
            const reader = new FileReader();
            reader.onload = (event) => {
                profilePhotoPreview.src = event.target.result;
            };
            reader.readAsDataURL(selectedFile);
        } else {
            profilePhotoPreview.src = "https://via.placeholder.com/96/E5E7EB/6B7280?text=+"; // Placeholder for no image
        }
    });

    /* === form submit === */
    const form=document.getElementById('authForm');
    form.addEventListener('submit',async e=>{
      e.preventDefault();
      toast.classList.add('hidden');
      const email=form.email.value.trim();
      const password=form.password.value;
      if(mode==='signup'){
        const confirm=form.confirm.value;
        if(password!==confirm){toast.textContent=TXT[lang].mismatch;toast.classList.remove('hidden');return;}
        
        // At this point, `selectedFile` holds the File object, or is null if no file chosen.
        // You would typically pass `selectedFile` to your backend/Firebase Storage here
        // AFTER the user account is successfully created, using the new user's UID.
        // For now, we'll just log it or use a placeholder URL.
        let profilePhotoURL = '';
        if (selectedFile) {
            // In a real application, you'd upload `selectedFile` to Firebase Storage here
            // after createUserWithEmailAndPassword, using the new user.uid in the path.
            // For now, we'll use a generic placeholder to show that a file was selected.
            profilePhotoURL = URL.createObjectURL(selectedFile); // For immediate visual confirmation, NOT for storage
            console.log("Selected file for upload:", selectedFile);
            console.log("Temporary preview URL (not for storage):", profilePhotoURL);
            // Replace with actual Firebase Storage upload logic when ready
        } else {
            profilePhotoURL = 'https://via.placeholder.com/96/2563EB/FFFFFF?text='; // Default placeholder if no image uploaded
        }


        try{
            const userCredential = await createUserWithEmailAndPassword(auth,email,password);
            const user = userCredential.user;
            
            // TODO: In a real application, after `createUserWithEmailAndPassword`:
            // 1. Upload `selectedFile` to Firebase Storage using `user.uid` for the path.
            //    Example: ref(storage, `profile_photos/${user.uid}/profile.jpg`)
            // 2. Get the actual `downloadURL` from Storage.
            // 3. Save this `downloadURL` (and the `role` from `roleSelect.value`) to Firestore for the user's profile.
            //    Example: setDoc(doc(db, 'users', user.uid), { role: form.roleSelect.value, profilePhotoURL: actualDownloadURL });
            console.log("User created:", user.uid);
            console.log("Assigned role:", document.getElementById('roleSelect').value);
            console.log("Profile photo URL (placeholder/temporary preview):", profilePhotoURL); // This would be the actual Storage URL

          window.location.href='/'; 
        }catch(err){
            toast.textContent=err.message;
            toast.classList.remove('hidden');
        }
      }else{
        try{await signInWithEmailAndPassword(auth,email,password);window.location.href='/';}
        catch(err){toast.textContent=err.message;toast.classList.remove('hidden');}
      }
    });

    // initial render
    applyLang();
  </script>
</body>
</html>
