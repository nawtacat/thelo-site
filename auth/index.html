<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>thelo ‚Äì Auth</title>
    <link rel="icon" href="https://thelo.space/img/thelofavicon.png" type="image/png" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;700;800&family=Noto+Serif+Armenian:wght@400;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>

    <!-- Font Awesome for Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

    <style>
        :root{
            --thelo-blue:#2563EB;
            --thelo-bg:#F8F9FA;
            --thelo-text:#111827;
            --grid-color:#E5E7EB;
        }
        body{
            font-family:'Manrope',system-ui,-apple-system,'Segoe UI','Helvetica Neue',Arial,sans-serif;
            background-color:var(--thelo-bg);
            color:var(--thelo-text);
            background-image:linear-gradient(to right,var(--grid-color) 1px,transparent 1px),
                             linear-gradient(to bottom,var(--grid-color) 1px,transparent 1px);
            background-size:40px 40px;
            min-height:100vh;
            display:flex;
            align-items:center;
            justify-content:center;
            padding:1.5rem;
        }
        html[lang="hy"] body{font-family:'Noto Serif Armenian',serif;}

        /* ‚Äî‚Äî‚Äî auth window ‚Äî‚Äî‚Äî */
        .window-container{
            background:#fff;
            border:1px solid var(--grid-color);
            border-radius:.75rem;
            padding:2.5rem;
            box-shadow:0 10px 15px -3px rgb(0 0 0/.1),0 4px 6px -4px rgb(0 0 0/.1);
            position:relative;
            max-width:480px;          /* wider on mobile/tablet  üîπ*/
            width:100%;
        }
        @media(min-width:768px){
            .window-container{max-width:820px;}  /* wider on desktop  üîπ*/
        }
        .window-container::before{
            content:" ";
            position:absolute;top:1rem;left:1rem;
            width:52px;height:12px;
            background-image:url("data:image/svg+xml,%3Csvg width='52' height='12' viewBox='0 0 52 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='6' cy='6' r='6' fill='%23FF5F56'/%3E%3Ccircle cx='26' cy='6' r='6' fill='%23FFBD2E'/%3E%3Ccircle cx='46' cy='6' r='6' fill='%2327C93F'/%3E%3C/svg%3E");
        }

        /* form inputs + helpers */
        .form-input{
            width:100%;
            border-radius:.5rem;
            border:1px solid #D1D5DB;
            background:#fff;
            padding:.75rem 1rem;
            box-shadow:0 1px 2px rgba(0,0,0,.05);
            transition:border-color .2s,box-shadow .2s;
        }
        .form-input:focus{
            border-color:var(--thelo-blue);
            outline:none;
            box-shadow:0 0 0 3px rgba(37,99,235,.2);
        }

        .profile-picture-upload-area{display:flex;flex-direction:column;align-items:center;margin-bottom:1rem;}
        .profile-picture-preview{
            width:96px;height:96px;border-radius:50%;object-fit:cover;border:2px solid var(--grid-color);
            margin-bottom:.5rem;background:#f0f0f0;display:flex;align-items:center;justify-content:center;
            color:#ccc;font-size:2.5rem;overflow:hidden;cursor:pointer;transition:border-color .2s,box-shadow .2s;
        }
        .profile-picture-preview:hover{border-color:var(--thelo-blue);box-shadow:0 0 0 3px rgba(37,99,235,.2);}
        .profile-picture-preview img{width:100%;height:100%;object-fit:cover;}
        .profile-picture-input{opacity:0;position:absolute;z-index:-1;}

        .loading-spinner{
            border:4px solid #f3f3f3;border-top:4px solid var(--thelo-blue);
            border-radius:50%;width:24px;height:24px;animation:spin 1s linear infinite;
            display:inline-block;vertical-align:middle;margin-left:.5rem;
        }
        @keyframes spin{to{transform:rotate(360deg)}}
        .form-button:disabled{opacity:.7;cursor:not-allowed;transform:none;}

        /* fixed nav/lang tweaks */
        @media(max-width:640px){
            .fixed.top-4.left-4,.fixed.top-4.right-4{
                top:.5rem;font-size:.75rem;padding:.25rem .5rem;
            }
            .fixed.top-4.left-4{left:.5rem;}
            .fixed.top-4.right-4{right:.5rem;}
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center px-6">
    <!-- Fixed nav + lang -->
    <a href="/" class="fixed top-4 left-4 text-sm font-semibold text-slate-500 hover:text-[var(--thelo-blue)]">
        <span id="homeArrow">‚Üê</span> <span id="homeLink">Home</span>
    </a>
    <button id="langToggle" class="fixed top-4 right-4 rounded-md border border-slate-300 px-3 py-1 text-xs font-semibold text-slate-600 hover:bg-slate-100">’Ä’°’µ</button>

    <!-- Auth card -->
    <div id="authWindowContainer" class="window-container w-full">
        <h2 id="formTitle" class="text-2xl font-extrabold mb-6 text-center">Sign In</h2>
        <p class="text-center text-sm mb-4">
            <span id="togglePrompt">Don't have an account?</span>
            <button id="toggleLink" class="text-[var(--thelo-blue)] font-semibold hover:underline">Create one</button>
        </p>

        <form id="authForm" class="grid grid-cols-1 gap-y-4">
            <!-- Profile picture upload (signup only) -->
            <div id="pfpUploadWrap" class="hidden profile-picture-upload-area md:col-span-2">
                <div class="profile-picture-preview" id="pfpPreview"><i class="fas fa-user-circle"></i></div>
                <input type="file" id="pfpInput" accept="image/*" class="profile-picture-input">
                <span id="pfpStatusText" class="text-sm text-slate-500 mt-1">Upload Profile Picture</span>
            </div>

            <!-- Name & surname (signup) -->
            <div id="nameWrap" class="hidden">
                <label id="labelName" for="nameInput" class="block text-sm font-bold mb-1">Name</label>
                <input id="nameInput" type="text" class="form-input" required>
            </div>
            <div id="surnameWrap" class="hidden">
                <label id="labelSurname" for="surnameInput" class="block text-sm font-bold mb-1">Surname</label>
                <input id="surnameInput" type="text" class="form-input" required>
            </div>

            <!-- Email + password -->
            <div id="emailDiv">
                <label id="labelEmail" for="email" class="block text-sm font-bold mb-1">Email</label>
                <input id="email" type="email" class="form-input" required>
            </div>
            <div id="roleWrap" class="hidden">
                <label id="labelRole" for="roleSelect" class="block text-sm font-bold mb-1">I am a:</label>
                <select id="roleSelect" class="form-input">
                    <option value="student" id="optStudent">Student</option>
                    <option value="teacher" id="optTeacher">Teacher</option>
                </select>
            </div>
            <div id="passwordDiv">
                <label id="labelPassword" for="password" class="block text-sm font-bold mb-1">Password</label>
                <input id="password" type="password" class="form-input" required>
            </div>
            <div id="confirmWrap" class="hidden">
                <label id="labelConfirm" for="confirm" class="block text-sm font-bold mb-1">Confirm Password</label>
                <input id="confirm" type="password" class="form-input">
            </div>

            <button id="submitBtn" type="submit" class="mt-2 rounded-lg bg-[var(--thelo-blue)] px-8 py-3 font-bold text-white shadow hover:scale-105 transition-transform md:col-span-2">Sign In</button>
        </form>

        <p id="toast" class="mt-6 text-center text-sm text-red-600 hidden"></p>
    </div>

    <!-- Firebase & logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

        const firebaseConfig = {
            apiKey:"AIzaSyAbnPpcIt88B0jIAoLUdC71zmQDvR_fdu8",
            authDomain:"physmathacademy-722b3.firebaseapp.com",
            projectId:"physmathacademy-722b3",
            storageBucket:"physmathacademy-722b3.appspot.com",
            appId:"1:1093640992262:web:35b1bf4d2364bcf745f587"
        };
        const app      = initializeApp(firebaseConfig);
        const auth     = getAuth(app);
        const db       = getFirestore(app);
        const storage  = getStorage(app);

        /* i18n text ... (unchanged) */
        const TXT={en:{home:"Home",signInTitle:"Sign In",signUpTitle:"Create Account",signInBtn:"Sign In",signUpBtn:"Create Account",toggleHave:"Don't have an account?",toggleHas:"Already have one?",toggleCreate:"Create one",toggleSignin:"Sign in",nameLabel:"Name",surnameLabel:"Surname",email:"Email",password:"Password",confirm:"Confirm Password",roleLabel:"I am a:",student:"Student",teacher:"Teacher",mismatch:"Passwords do not match",uploadPfpLabel:"Upload Profile Picture",pfpUploading:"Uploading..."},hy:{home:"‘≥’¨’≠’°’æ’∏÷Ä",signInTitle:"’Ñ’∏÷Ç’ø÷Ñ",signUpTitle:"’ç’ø’•’≤’Æ’•’¨ ’∞’°’∑’´’æ",signInBtn:"’Ñ’∏÷Ç’ø÷Ñ",signUpBtn:"’ç’ø’•’≤’Æ’•’¨",toggleHave:"’â’∏÷Ç’∂’•’û÷Ñ ’∞’°’∑’´’æ?",toggleHas:"‘±÷Ä’§’•’∂ ’∏÷Ç’∂’•’û÷Ñ ’∞’°’∑’´’æ?",toggleCreate:"’ç’ø’•’≤’Æ’•’¨",toggleSignin:"’Ñ’∏÷Ç’ø÷Ñ",nameLabel:"‘±’∂’∏÷Ç’∂",surnameLabel:"‘±’¶’£’°’∂’∏÷Ç’∂",email:"‘∑’¨-÷É’∏’Ω’ø",password:"‘≥’°’≤’ø’∂’°’¢’°’º",confirm:"‘ø÷Ä’Ø’∂’•’¨ ’£’°’≤’ø’∂’°’¢’°’º’®",roleLabel:"‘µ’Ω’ù",student:"’à÷Ç’Ω’°’∂’∏’≤ ’•’¥",teacher:"’à÷Ç’Ω’∏÷Ç÷Å’´’π ’•’¥",mismatch:"‘≥’°’≤’ø’∂’°’¢’°’º’•÷Ä’® ’π’•’∂ ’∞’°’¥’®’∂’Ø’∂’∏÷Ç’¥",uploadPfpLabel:"’Ü’•÷Ä’¢’•’º’∂’•’¨ ’∫÷Ä’∏÷Ü’´’¨’´ ’∂’Ø’°÷Ä",pfpUploading:"’Ü’•÷Ä’¢’•’º’∂’∏÷Ç’¥..."}};

        /* DOM handles (unchanged) */
        const langBtn=document.getElementById('langToggle');
        const homeLink=document.getElementById('homeLink');
        const form=document.getElementById('authForm');
        const authWindowContainer=document.getElementById('authWindowContainer');
        const formTitle=document.getElementById('formTitle');
        const togglePrompt=document.getElementById('togglePrompt');
        const toggleLink=document.getElementById('toggleLink');
        const nameWrap=document.getElementById('nameWrap');
        const surnameWrap=document.getElementById('surnameWrap');
        const emailDiv=document.querySelector('#emailDiv');
        const passwordDiv=document.querySelector('#passwordDiv');
        const labelName=document.getElementById('labelName');
        const labelSurname=document.getElementById('labelSurname');
        const labelEmail=document.getElementById('labelEmail');
        const labelPassword=document.getElementById('labelPassword');
        const labelConfirm=document.getElementById('labelConfirm');
        const labelRole=document.getElementById('labelRole');
        const optStudent=document.getElementById('optStudent');
        const optTeacher=document.getElementById('optTeacher');
        const confirmWrap=document.getElementById('confirmWrap');
        const roleWrap=document.getElementById('roleWrap');
        const submitBtn=document.getElementById('submitBtn');
        const toast=document.getElementById('toast');
        const pfpUploadWrap=document.getElementById('pfpUploadWrap');
        const pfpPreview=document.getElementById('pfpPreview');
        const pfpInput=document.getElementById('pfpInput');
        const pfpStatusText=document.getElementById('pfpStatusText');
        const nameInput=document.getElementById('nameInput');
        const surnameInput=document.getElementById('surnameInput');

        let lang='en';
        let mode='signin';
        let selectedFile=null;

        function applyLang(){
            const s=TXT[lang];
            document.documentElement.lang=lang;
            langBtn.textContent=lang==='en'?'’Ä’°’µ':'EN';
            homeLink.textContent=s.home;
            labelName.textContent=s.nameLabel;
            labelSurname.textContent=s.surnameLabel;
            labelEmail.textContent=s.email;
            labelPassword.textContent=s.password;
            labelConfirm.textContent=s.confirm;
            labelRole.textContent=s.roleLabel;
            optStudent.textContent=s.student;
            optTeacher.textContent=s.teacher;
            pfpStatusText.textContent=s.uploadPfpLabel;

            if(mode==='signup'){
                formTitle.textContent=s.signUpTitle;
                togglePrompt.textContent=s.toggleHas;
                toggleLink.textContent=s.toggleSignin;
                submitBtn.textContent=s.signUpBtn;
            }else{
                formTitle.textContent=s.signInTitle;
                togglePrompt.textContent=s.toggleHave;
                toggleLink.textContent=s.toggleCreate;
                submitBtn.textContent=s.signInBtn;
            }
        }

        function setMode(m){
            mode=m;
            /* reset pfp preview */
            pfpPreview.innerHTML='<i class="fas fa-user-circle"></i>';
            selectedFile=null;
            pfpInput.value='';

            if(m==='signup'){
                form.classList.add('md:grid-cols-2','md:gap-x-4');
                pfpUploadWrap.classList.remove('hidden');
                nameWrap.classList.remove('hidden');
                surnameWrap.classList.remove('hidden');
                confirmWrap.classList.remove('hidden');
                roleWrap.classList.remove('hidden');
            }else{
                form.classList.remove('md:grid-cols-2','md:gap-x-4');
                form.classList.add('md:grid-cols-1');        /* üîπ keep one column */
                pfpUploadWrap.classList.add('hidden');
                nameWrap.classList.add('hidden');
                surnameWrap.classList.add('hidden');
                confirmWrap.classList.add('hidden');
                roleWrap.classList.add('hidden');
            }
            applyLang();
            toast.classList.add('hidden'); toast.textContent='';
        }

        /* pfp preview */
        pfpInput.addEventListener('change',e=>{
            const file=e.target.files[0];
            if(file){
                selectedFile=file;
                const reader=new FileReader();
                reader.onload=e=>{
                    pfpPreview.innerHTML=`<img src="${e.target.result}" alt="Profile Preview">`;
                };
                reader.readAsDataURL(file);
            }else{
                selectedFile=null;
                pfpPreview.innerHTML='<i class="fas fa-user-circle"></i>';
            }
            pfpStatusText.textContent=TXT[lang].uploadPfpLabel;
        });
        pfpPreview.addEventListener('click',()=>pfpInput.click());

        /* UI toggles */
        langBtn.addEventListener('click',()=>{lang=lang==='en'?'hy':'en';applyLang();});
        toggleLink.addEventListener('click',()=>setMode(mode==='signin'?'signup':'signin'));

        /* form submit  ‚Ä¶ (unchanged logic except spinner text is rebuilt) */
        form.addEventListener('submit',async e=>{
            e.preventDefault();toast.classList.add('hidden');toast.textContent='';
            const email=form.email.value.trim();
            const password=form.password.value;
            const s=TXT[lang];

            submitBtn.disabled=true;
            submitBtn.innerHTML=`${mode==='signup'?s.signUpBtn:s.signInBtn}<span class="loading-spinner"></span>`;

            if(mode==='signup'){
                const name=nameInput.value.trim();
                const surname=surnameInput.value.trim();
                const confirm=form.confirm.value;
                if(!name||!surname){
                    toast.textContent="Please enter your name and surname.";
                    toast.classList.remove('hidden');submitBtn.disabled=false;submitBtn.innerHTML=s.signUpBtn;return;
                }
                if(password!==confirm){
                    toast.textContent=s.mismatch;
                    toast.classList.remove('hidden');submitBtn.disabled=false;submitBtn.innerHTML=s.signUpBtn;return;
                }
                try{
                    const uc=await createUserWithEmailAndPassword(auth,email,password);
                    const user=uc.user;
                    let pfpUrl='';
                    if(selectedFile){
                        try{
                            pfpStatusText.textContent=s.pfpUploading;
                            const fileRef=ref(storage,`users/${user.uid}/profile.jpg`);
                            await uploadBytes(fileRef,selectedFile);
                            pfpUrl=await getDownloadURL(fileRef);
                        }catch(err){console.error(err);}
                    }
                    const role=form.roleSelect.value;
                    await setDoc(doc(db,'users',user.uid),{name,surname,email,role,pfpUrl});
                    toast.textContent="Signup successful! Redirecting...";
                    toast.classList.remove('text-red-600','hidden');toast.classList.add('text-green-600');
                    setTimeout(()=>window.location.href='/student-dashboard.html',1500);
                }catch(err){
                    toast.textContent=err.message;toast.classList.remove('hidden');toast.classList.add('text-red-600');
                }finally{
                    submitBtn.disabled=false;submitBtn.innerHTML=s.signUpBtn;pfpStatusText.textContent=s.uploadPfpLabel;
                }
            }else{ /* sign-in */
                try{
                    await signInWithEmailAndPassword(auth,email,password);
                    toast.textContent="Sign in successful! Redirecting...";
                    toast.classList.remove('text-red-600','hidden');toast.classList.add('text-green-600');
                    setTimeout(()=>window.location.href='/student-dashboard.html',1500);
                }catch(err){
                    toast.textContent=err.message;toast.classList.remove('hidden');toast.classList.add('text-red-600');
                }finally{
                    submitBtn.disabled=false;submitBtn.innerHTML=s.signInBtn;
                }
            }
        });

        /* initial paint */
        applyLang();
    </script>
</body>
</html>
