<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desmos Solver: System of Equations</title>
    
    <script src="https://www.desmos.com/api/v1.9/calculator.js?apiKey=dcb31709b452b1cf9dc26972add0fda6"></script>

    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f4f8;
        }

        #header {
            width: 100%;
            background: white;
            padding: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            text-align: center;
            margin-bottom: 20px;
        }

        #calculator {
            width: 90vw;
            height: 70vh;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        #controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        button {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            background-color: #2d70b3;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.1s, background 0.2s;
        }

        button:hover {
            background-color: #1e548a;
            transform: scale(1.05);
        }

        #status {
            font-size: 1.1rem;
            color: #333;
            font-weight: 500;
            min-width: 300px;
            text-align: center;
        }
    </style>
</head>
<body>

    <div id="header">
        <h2>System of Equations Solver</h2>
        <p style="margin:5px 0; color:#666; font-size:0.9em;">Solving for (x + y)</p>
    </div>

    <div id="calculator"></div>

    <div id="controls">
        <button onclick="runSolverSequence()">Solve My Problem</button>
        <div id="status">Status: Ready</div>
    </div>

    <script>
        // --- CONFIGURATION ---
        var elt = document.getElementById('calculator');
        var calculator = Desmos.GraphingCalculator(elt, {
            keypad: true,
            expressions: true,
            settingsMenu: true
        });

        // Helper to create delays (Pause logic)
        const wait = (ms) => new Promise(resolve => setTimeout(resolve, ms));

        // --- MAIN SEQUENCE ---
        async function runSolverSequence() {
            // 1. Reset
            calculator.setBlank();
            calculator.setMathBounds({ left: -10, right: 10, bottom: -10, top: 10 });
            updateStatus("Starting tutor session...");
            await wait(1000);

            // 2. Type Equation 1: 0.5x + y = 1
            // We use 0.5x to represent 1/2x for cleaner typing animation
            updateStatus("Typing Equation 1...");
            await typeHuman("0.5x + y = 1", "eq1", Desmos.Colors.RED);
            await wait(800);

            // 3. Type Equation 2: -2x - y = 5
            updateStatus("Typing Equation 2...");
            await typeHuman("-2x - y = 5", "eq2", Desmos.Colors.BLUE);
            await wait(1000);

            // 4. Pan to the Intersection
            // Algebraically: 
            // 0.5x + y = 1
            // -2x - y = 5
            // Add them: -1.5x = 6 -> x = -4. 
            // If x = -4, y = 3. 
            // Intersection is (-4, 3).
            updateStatus("Looking for intersection...");
            await smoothPanTo(-4, 3); 
            await wait(500);

            // 5. Mark the intersection point
            updateStatus("Found solution (-4, 3)");
            // We type this instantly or animate it? Let's animate it quickly.
            await typeHuman("(-4, 3)", "sol", Desmos.Colors.BLACK, "Solution");
            await wait(1000);

            // 6. Calculate the final answer (x + y)
            updateStatus("Calculating x + y...");
            // We will type the arithmetic to show the logic: -4 + 3
            await typeHuman("-4 + 3", "ans", Desmos.Colors.GREEN, "x + y");
            
            updateStatus("Answer is -1 (Option B)");
        }

        // --- HUMAN TYPING HELPER (Returns Promise) ---
        function typeHuman(fullString, id, color, label = null) {
            return new Promise((resolve) => {
                let index = 0;
                
                // Initialize the expression object
                let exprObj = { 
                    id: id, 
                    color: color, 
                    latex: "" 
                };
                if (label) {
                    exprObj.label = label;
                    exprObj.showLabel = true;
                }

                function typeLoop() {
                    if (index <= fullString.length) {
                        exprObj.latex = fullString.substring(0, index);
                        calculator.setExpression(exprObj);

                        // Randomized typing speed
                        let char = fullString.charAt(index);
                        let delay = 50 + Math.random() * 100; // base speed
                        
                        // Pause longer for spaces, equals, or operators to "think"
                        if ([" ", "=", "+", "-"].includes(char)) delay += 200;

                        index++;
                        setTimeout(typeLoop, delay);
                    } else {
                        resolve(); // Typing finished
                    }
                }

                typeLoop();
            });
        }

        // --- SMOOTH PANNING HELPER (Returns Promise) ---
        function smoothPanTo(targetX, targetY) {
            return new Promise((resolve) => {
                const currentBounds = calculator.graphpaperBounds.mathCoordinates;
                const width = currentBounds.right - currentBounds.left;
                const height = currentBounds.top - currentBounds.bottom;

                // We want the target (x,y) to be in the center
                const targetBounds = {
                    left: targetX - (width / 2),
                    right: targetX + (width / 2),
                    bottom: targetY - (height / 2),
                    top: targetY + (height / 2)
                };

                let frame = 0;
                const totalFrames = 80; // approx 1.5 seconds

                function animate() {
                    frame++;
                    const progress = frame / totalFrames;
                    // Ease Out Cubic: 1 - (1 - t)^3
                    const ease = 1 - Math.pow(1 - progress, 3);

                    const newL = currentBounds.left + (targetBounds.left - currentBounds.left) * ease;
                    const newR = currentBounds.right + (targetBounds.right - currentBounds.right) * ease;
                    const newB = currentBounds.bottom + (targetBounds.bottom - currentBounds.bottom) * ease;
                    const newT = currentBounds.top + (targetBounds.top - currentBounds.top) * ease;

                    calculator.setMathBounds({
                        left: newL, 
                        right: newR, 
                        bottom: newB, 
                        top: newT
                    });

                    if (frame < totalFrames) {
                        requestAnimationFrame(animate);
                    } else {
                        resolve(); // Animation finished
                    }
                }
                requestAnimationFrame(animate);
            });
        }

        function updateStatus(text) {
            document.getElementById('status').innerText = "Status: " + text;
        }
        
        // Auto-start for convenience
        window.onload = () => {
            setTimeout(runSolverSequence, 1000);
        };

    </script>
</body>
</html>
