<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desmos Tutor: Slower, Narrated Problem Solving</title>
    
    <script src="https://www.desmos.com/api/v1.9/calculator.js?apiKey=dcb31709b452b1cf9dc26972add0fda6"></script>

    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f4f8;
        }

        #header {
            width: 100%;
            background: white;
            padding: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            text-align: center;
            margin-bottom: 20px;
        }

        #calculator {
            width: 90vw;
            height: 70vh;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        #controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        button {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            background-color: #007bff; /* Blue for a clean look */
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.1s, background 0.2s;
        }

        button:hover {
            background-color: #0056b3;
            transform: scale(1.05);
        }

        #status {
            font-size: 1.1rem;
            color: #333;
            font-weight: 500;
            min-width: 300px;
            text-align: center;
            padding: 5px 10px;
            border: 1px dashed #aaa;
            border-radius: 4px;
            background-color: #fff;
        }
    </style>
</head>
<body>

    <div id="header">
        <h2>Interactive System Solver Demonstration</h2>
        <p style="margin:5px 0; color:#666; font-size:0.9em;">Watch the steps slowly, just like a human tutor would teach.</p>
    </div>

    <div id="calculator"></div>

    <div id="controls">
        <button onclick="runTutorSession()">Restart Lesson</button>
        <div id="status">Status: Ready</div>
    </div>

    <script>
        // --- CONFIGURATION ---
        var elt = document.getElementById('calculator');
        var calculator = Desmos.GraphingCalculator(elt, {
            keypad: true,
            expressions: true,
            settingsMenu: true
        });

        // Helper to create delays (Pause logic)
        const wait = (ms) => new Promise(resolve => setTimeout(resolve, ms));

        // --- MAIN TUTOR SEQUENCE ---
        async function runTutorSession() {
            // 1. Reset
            calculator.setBlank();
            calculator.setMathBounds({ left: -10, right: 10, bottom: -10, top: 10 });
            updateStatus("ðŸ‘‹ Welcome! Let's solve this system of equations.");
            await wait(2000);

            // 2. Type Equation 1: 0.5x + y = 1
            updateStatus("âœï¸ First, we enter the first equation: 0.5x + y = 1.");
            await typeHuman("0.5x + y = 1", "eq1", Desmos.Colors.RED);
            await wait(2500); // Long pause for student to analyze the line

            // 3. Type Equation 2: -2x - y = 5
            updateStatus("âœï¸ Now, we enter the second equation: -2x - y = 5. The solution is where they meet.");
            await typeHuman("-2x - y = 5", "eq2", Desmos.Colors.BLUE);
            await wait(2500); // Long pause for student to find the intersection

            // 4. Pan to the Intersection (-4, 3)
            updateStatus("ðŸ”Ž Let's zoom in and focus on the intersection point.");
            await smoothPanTo(-4, 3); 
            await wait(1500);

            // 5. Mark the intersection point
            updateStatus("ðŸ’¡ The point of intersection is (-4, 3). This is our solution (x, y).");
            await typeHuman("(-4, 3)", "sol", Desmos.Colors.BLACK, "Solution (x, y)");
            await wait(2000);

            // 6. Calculate the final answer (x + y)
            updateStatus("ðŸ¤” The question asks for the value of x + y. Let's plug in our numbers.");
            await typeHuman("x + y = (-4) + 3", "calc_setup", Desmos.Colors.GREEN);
            await wait(1500);

            // 7. Show the final result
            updateStatus("âœ… The final calculation is -1. The answer is B.");
            await typeHuman("= -1", "ans", Desmos.Colors.GREEN);
            await wait(3000);

            updateStatus("Lesson Complete! Press 'Restart Lesson' to review the steps.");
        }

        // --- HUMAN TYPING HELPER (Returns Promise) ---
        function typeHuman(fullString, id, color, label = null) {
            return new Promise((resolve) => {
                let index = 0;
                
                let exprObj = { 
                    id: id, 
                    color: color, 
                    latex: "" 
                };
                if (label) {
                    exprObj.label = label;
                    exprObj.showLabel = true;
                }

                function typeLoop() {
                    if (index <= fullString.length) {
                        exprObj.latex = fullString.substring(0, index);
                        calculator.setExpression(exprObj);

                        // Randomized typing speed for human feel
                        let char = fullString.charAt(index);
                        let delay = 75 + Math.random() * 150; // base speed is slightly slower
                        
                        // Pause longer for complex characters
                        if ([" ", "=", "+", "-"].includes(char)) delay += 250;

                        index++;
                        setTimeout(typeLoop, delay);
                    } else {
                        resolve(); // Typing finished
                    }
                }

                typeLoop();
            });
        }

        // --- SMOOTH PANNING HELPER (Returns Promise) ---
        function smoothPanTo(targetX, targetY) {
            return new Promise((resolve) => {
                const currentBounds = calculator.graphpaperBounds.mathCoordinates;
                // Preserve the current zoom level, just center the view
                const width = currentBounds.right - currentBounds.left;
                const height = currentBounds.top - currentBounds.bottom;

                const targetBounds = {
                    left: targetX - (width / 2),
                    right: targetX + (width / 2),
                    bottom: targetY - (height / 2),
                    top: targetY + (height / 2)
                };

                let frame = 0;
                const totalFrames = 100; // longer animation (about 1.6 seconds)

                function animate() {
                    frame++;
                    const progress = frame / totalFrames;
                    const ease = 1 - Math.pow(1 - progress, 3); // Ease Out Cubic

                    const newL = currentBounds.left + (targetBounds.left - currentBounds.left) * ease;
                    const newR = currentBounds.right + (targetBounds.right - currentBounds.right) * ease;
                    const newB = currentBounds.bottom + (targetBounds.bottom - currentBounds.bottom) * ease;
                    const newT = currentBounds.top + (targetBounds.top - currentBounds.top) * ease;

                    calculator.setMathBounds({ left: newL, right: newR, bottom: newB, top: newT });

                    if (frame < totalFrames) {
                        requestAnimationFrame(animate);
                    } else {
                        resolve(); // Animation finished
                    }
                }
                requestAnimationFrame(animate);
            });
        }

        function updateStatus(text) {
            document.getElementById('status').innerText = text;
        }
        
        // Auto-start
        window.onload = () => {
            setTimeout(runTutorSession, 1000);
        };
    </script>
</body>
</html>
