<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="dashboardTitle">Thelo Student Dashboard</title>
    <link rel="icon" href="https://thelo.space/img/thelofavicon.png" type="image/png" />

    <!-- Google Fonts: Manrope (for English) & Noto Serif Armenian -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;700;800&family=Noto+Serif+Armenian:wght@400;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome for Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

    <style>
        :root {
            --thelo-blue: #2563EB;
            --thelo-bg: #F8F9FA; /* This is the base background for the grid itself */
            --thelo-text: #111827;
            --grid-color: #E5E7EB;
            --card-hover-shadow: 0 8px 15px rgba(0, 0, 0, 0.08); /* Slightly lighter hover shadow */
        }

        html {
            scroll-behavior: smooth;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        body {
            font-family: 'Manrope', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--thelo-bg);
            color: var(--thelo-text);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            
            /* The signature grid background directly on the body */
            background-image:
                linear-gradient(to right, var(--grid-color) 1px, transparent 1px),
                linear-gradient(to bottom, var(--grid-color) 1px, transparent 1px);
            background-size: 40px 40px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 0; /* Ensure no default body padding */
            margin: 0; /* Ensure no default body margin */
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        /* Language-specific font rules */
        html[lang="en"] body {
            font-family: 'Manrope', sans-serif;
        }
        html[lang="hy"] body {
            font-family: "Noto Serif Armenian", serif;
        }

        h1, h2, h3, h4, h5, h6 {
            font-weight: 800; /* Bolder Manrope */
        }
        html[lang="hy"] h1, 
        html[lang="hy"] h2, 
        html[lang="hy"] h3, 
        html[lang="hy"] h4, 
        html[lang="hy"] h5, 
        html[lang="hy"] h6 {
            font-weight: 700; /* Bolder Noto Serif Armenian */
        }

        /* Header (Minimalist and Transparent) */
        header {
            background-color: transparent; /* No white box on navbar */
            backdrop-filter: none; /* No blur */
            border-bottom: none; /* No border */
            padding: 1.5rem 2.5rem; /* Enhanced padding from borders */
            display: flex;
            justify-content: space-between; /* Space out logo and right section */
            align-items: center;
            width: 100%;
            z-index: 10; /* Ensure it stays on top */
            position: relative; 
        }
        /* REMOVED macOS style window buttons from header and page */
        header::before, #welcome-overview::before {
            display: none;
        }

        /* Main Content Area ‚Äì wider cap & full-width fallback */
main{
    flex-grow:1;                 /* let it fill the remaining height             */
    padding:3rem 2.5rem;         /* keep the inner breathing-room                */

    /* ‚ù∂ remove the hard 1600 px stop, but keep a sensible upper limit          */
    max-width: 95vw;             /* 95 % of the viewport ‚Üí expands on big screens */
    width: 100%;                 /* on small screens it can still shrink nicely   */

    margin-inline:auto;          /* centres the block                            */
    overflow-x:hidden;           /* safety: no sideways scroll from wide children*/
}


        section {
            margin-bottom: 4.5rem; /* More space between sections */
        }

        /* Card Style (General purpose for progress, topic, course) */
        .thelo-card {
            background-color: white; /* White background for individual cards */
            border: 1px solid var(--grid-color);
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            padding: 2rem; /* Increased padding within cards */
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; /* Add transition for hover */
        }

        .thelo-card:hover {
            transform: translateY(-5px); /* Lift card on hover */
            box-shadow: var(--card-hover-shadow); /* Stronger shadow on hover */
        }

        /* Primary Button Style */
        .thelo-btn {
            background-color: var(--thelo-blue);
            color: white;
            font-weight: 700;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .thelo-btn:hover {
            background-color: #1a56d2;
            transform: translateY(-2px);
        }

        /* Secondary Button Style */
        .thelo-btn-secondary {
            background-color: transparent;
            color: var(--thelo-blue);
            border: 1px solid var(--thelo-blue);
            font-weight: 700;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .thelo-btn-secondary:hover {
            background-color: var(--thelo-blue);
            color: white;
        }

        /* Progress Bar */
        .progress-bar-container {
            width: 100%;
            background-color: var(--grid-color);
            border-radius: 0.5rem;
            overflow: hidden;
        }
        .progress-bar {
            height: 10px;
            background-color: var(--thelo-blue);
            border-radius: 0.5rem;
            transition: width 0.5s ease-in-out;
        }

        /* Specific styles for elements within new structure */
        .topic-card-context {
            font-size: 0.85rem;  
            color: #6B7280;
            margin-bottom: 0.5rem;
        }

        /* Course Item Styling (accordion header) */
        .course-item {
            background-color: white;
            border: 1px solid var(--grid-color);
            border-radius: 0.75rem;
            margin-bottom: 1rem; /* Space between courses */
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }

        .course-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem 2rem;
            cursor: pointer;
            font-weight: 700;
            color: var(--thelo-text);
            transition: background-color 0.2s ease-in-out;
        }
        .course-header:hover {
            background-color: #F3F4F6; /* light gray hover */
        }

        .course-header .course-info {
            flex-grow: 1;
        }

        .course-header .course-title-text {
            font-size: 1.25rem; /* text-xl */
            font-weight: 800;
        }

        .course-header .course-meta {
            font-size: 0.9rem;
            color: #6B7280;
            margin-top: 0.5rem;
        }
        
        .course-header .expand-icon {
            margin-left: 1.5rem;
            transition: transform 0.3s ease-in-out;
        }
        .course-header.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .course-content {
            padding: 0 2rem 1.5rem 2rem;
            display: none; /* Hidden by default */
            max-height: 0; /* For smooth accordion animation */
            overflow: hidden; /* Hide overflow during animation */
            transition: max-height 0.3s ease-out; /* Smooth transition for expand/collapse */
        }
        .course-content.active {
            max-height: fit-content; /* Will be set by JS dynamically */
        }

        .unit-item {
            background-color: var(--thelo-bg); /* Use thelo-bg for units */
            border: 1px solid #D1D5DB; /* Slightly darker border for units */
            border-radius: 0.5rem;
            margin-top: 1rem;
            padding: 1rem 1.5rem;
        }
        .unit-title {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.75rem;
        }
        .topic-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .topic-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px dashed #E5E7EB; /* Dashed separator */
            font-size: 0.95rem;
        }
        .topic-item:last-child {
            border-bottom: none;
        }
        .topic-item-name {
            flex-grow: 1; /* Allow name to take space */
            margin-right: 1rem; /* Space before status/button */
        }
        .topic-item-status {
            font-weight: 600;
            margin-left: 1rem;
            min-width: 100px; /* Give status some room */
            text-align: right;
        }
        .topic-item-status .fa-check-circle { color: #10B981; /* Green */ }
        .topic-item-status .fa-clock { color: #F59E0B; /* Amber */ }
        .topic-item-status .fa-times-circle { color: #EF4444; /* Red */ }

        .topic-action-btn {
            background-color: var(--thelo-blue);
            color: white;
            font-weight: 600;
            padding: 0.4rem 0.8rem;
            border-radius: 0.3rem;
            transition: background-color 0.2s ease-in-out;
            margin-left: 1rem; /* Space between status and button */
        }
        .topic-action-btn:hover {
            background-color: #1a56d2;
        }

        /* Profile Photo in Navbar (now acts as settings button) */
        .profile-photo-nav {
            width: 40px;  
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid transparent; /* No border initially */
            transition: border-color 0.2s ease-in-out, transform 0.2s ease-in-out;
        }
        .profile-photo-nav:hover {
            border-color: var(--thelo-blue); /* Blue border on hover */
            transform: scale(1.05);
        }

        /* Thelobook button in Navbar */
        .thelobook-nav-btn {
            background-color: transparent;
            color: var(--thelo-text);
            font-weight: 700;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: color 0.2s, background-color 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .thelobook-nav-btn:hover {
            color: var(--thelo-blue);
            background-color: rgba(37, 99, 235, 0.1);
        }
        
        /* Specific Styles for Achievements/Encouragement Section */
        .achievement-card {
            background-color: white;
            border: 1px solid var(--grid-color);
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .achievement-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-hover-shadow);
        }
        .achievement-icon {
            font-size: 3rem;
            color: var(--thelo-blue);
            margin-bottom: 1rem;
        }
        .achievement-message {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--thelo-text);
        }
        .achievement-description {
            font-size: 1rem;
            color: #6B7280;
            margin-top: 0.5rem;
        }

        /* Join Class Section */
        .join-class-card {
            background-color: white;
            border: 1px solid var(--grid-color);
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        .join-class-card input {
            margin-bottom: 1rem;
        }

        /* macOS style window buttons on the Welcome section heading */
        #welcome-stats::before { /* Changed ID from welcome-overview */
            content: ' ';
            position: absolute; /* Needs parent with position: relative */
            top: 2rem; /* Adjusted for better visual alignment within section */
            left: 2rem;
            width: 52px;
            height: 12px;
            background-image: url("data:image/svg+xml,%3Csvg width='52' height='12' viewBox='0 0 52 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='6' cy='6' r='6' fill='%23FF5F56'/%3E%3Ccircle cx='26' cy='6' r='6' fill='%23FFBD2E'/%3E%3Ccircle cx='46' cy='6' r='6' fill='%2327C93F'/%3E%3C/svg%3E%0A");
            background-repeat: no-repeat;
            z-index: 10;
        }
        /* Make welcome-stats section relative for absolute positioning of dots */
        #welcome-stats { /* Changed ID from welcome-overview */
            position: relative;
            padding-top: 3.5rem; /* Add extra padding to make space for dots */
        }
        #welcome-stats h2 { /* Changed ID from welcome-overview */
            margin-top: 0; /* Remove top margin if padding is used on parent */
        }

        /* Mobile adjustments */
        @media (max-width: 767px) {
            header {
                padding: 1rem 1.5rem; /* Reduced header padding */
                flex-direction: row;  /* Keep horizontal on mobile */
                justify-content: space-between; /* Space out logo and right section */
                align-items: center;
            }
            header > div:last-child { /* Targets the div containing thelobook and profile photo */
                width: auto; /* Remove 100% width on mobile header */
                margin-top: 0; /* No top margin on mobile header */
            }
            main {
                padding: 1.5rem;  
            }
            section {
                margin-bottom: 3rem;  
            }
            .thelo-card {
                padding: 1.25rem;
            }
            /* Adjust grid for cards */
            #primary-action-cards {
                gap: 1.5rem;
            }

            .course-header {
                padding: 1rem 1.5rem;
                flex-wrap: wrap;  
            }
            .course-header .course-info {
                width: 100%;
                margin-bottom: 0.5rem;
            }
            .course-header .course-meta {
                width: 100%;
                text-align: left;
                margin-top: 0;
            }
            .course-header .expand-icon {
                margin-left: auto;  
            }
            .course-content {
                padding: 0 1.5rem 1rem 1.5rem;
            }
            .unit-item {
                padding: 0.75rem 1rem;
            }
            .unit-title {
                margin-bottom: 0.5rem;
            }
            .topic-item {
                flex-wrap: wrap;
                padding: 0.5rem 0;
            }
            .topic-item-name {
                width: calc(100% - 70px);  
                flex-grow: 1;
            }
            .topic-item-status {
                margin-left: 0;
                order: 3;  
                width: 100%;
                text-align: left;
                margin-top: 0.25rem;
            }
            .topic-action-btn {
                margin-left: auto;  
            }
            /* macOS dots on welcome section for mobile */
            #welcome-stats::before { /* Changed ID from welcome-overview */
                top: 1rem;
                left: 1rem;
                transform: scale(0.8);
                transform-origin: top left;
            }
            #welcome-stats { /* Changed ID from welcome-overview */
                padding-top: 2.5rem;  
            }
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header Navigation -->
    <header>
        <div class="flex items-center gap-4">
            <img src="https://thelo.space/img/thelo-Photoroom.png" alt="Thelo logo" class="h-10 w-auto" />
        </div>
        <div class="flex items-center gap-4">
            <!-- Thelobook button in Navbar -->
            <button id="open-thelobook-btn" class="thelobook-nav-btn" data-i18n="openThelobookBtn">
                <i class="fas fa-book-open mr-2"></i> <span data-i18n="thelobookBtnText">thelobook</span>
            </button>
            <!-- Profile Photo (acts as settings button) -->
            <img id="profile-photo-nav" src="https://via.placeholder.com/150/2563EB/FFFFFF?text=P" alt="Profile Photo" class="profile-photo-nav" title="Profile Settings">
        </div>
    </header>

    <!-- Main Content Area -->
    <main>
        <!-- Section 1: Welcome Message & Quick Stats -->
        <section id="welcome-stats" class="mb-12">
            <h2 class="text-3xl lg:text-4xl font-extrabold text-[var(--thelo-text)] mb-8" data-i18n="welcomeGreeting">Good afternoon, <span id="student-name">Student</span>!</h2>
            
            <!-- Quick Stats -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="thelo-card flex flex-col items-start">
                    <h3 class="text-xl font-semibold mb-3" data-i18n="pointsTitle">Points</h3>
                    <p class="text-5xl font-bold text-[var(--thelo-blue)]" id="student-points">0</p>
                </div>
                <div class="thelo-card flex flex-col items-start">
                    <h3 class="text-xl font-semibold mb-3" data-i18n="lessonsCompletedTitle">Lessons Completed</h3>
                    <p class="text-5xl font-bold text-[var(--thelo-blue)]" id="lessons-completed-count">0</p>
                </div>
                <div class="thelo-card flex flex-col items-start">
                    <h3 class="text-xl font-semibold mb-3" data-i18n="streakTitle">Current Streak</h3>
                    <p class="text-5xl font-bold text-[var(--thelo-blue)]" id="streak-count">0 <span class="text-orange-500">üî•</span></p>
                </div>
            </div>
        </section>

        <!-- Section 2: Continue Practice -->
        <section id="continue-practice" class="mb-12">
            <h2 class="text-2xl lg:text-3xl font-extrabold text-[var(--thelo-text)] mb-6" data-i18n="continuePracticeTitle">Continue Practice</h2>
            
            <!-- Conditional Card for In-Progress Lesson -->
            <div id="in-progress-lesson-card" class="thelo-card flex flex-col items-start hidden">
                <div>
                    <p class="text-sm text-slate-600 mb-2" data-i18n="lastTopicContext">Last Topic: <span class="font-semibold text-[var(--thelo-blue)]" id="last-topic-name">Area of Circles</span></p>
                    <p class="text-sm text-slate-600 mb-2" data-i18n="topicStats"><span id="problems-count">0</span> Problems ‚Ä¢ <span id="progress-percentage">0%</span> Complete</p>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="last-topic-progress-bar" style="width: 0%;"></div>
                    </div>
                </div>
                <button id="resume-practice-btn" class="thelo-btn w-full mt-4" data-i18n="resumePracticeBtn">
                    <i class="fas fa-play-circle mr-2"></i> Resume Practice
                </button>
            </div>
            
            <!-- Message if no in-progress lessons -->
            <div id="no-in-progress-message" class="thelo-card text-center py-8">
                <p class="text-lg text-slate-600" data-i18n="noInProgressMessage">No in-progress lessons. Start a new topic below!</p>
            </div>
        </section>

        <!-- Section 3: SAT Math Units (Bulk Practice) -->
        <section id="sat-math-units" class="mb-12">
            <h2 class="text-2xl lg:text-3xl font-extrabold text-[var(--thelo-text)] mb-6" data-i18n="satMathUnitsTitle">SAT Math Units (Bulk Practice)</h2>
            
            <div id="units-accordion">
                <!-- Unit 1: Arithmetic & Number Properties -->
                <div class="course-item">
                    <div class="course-header" data-unit-id="arithmetic">
                        <div class="course-info">
                            <h3 class="course-title-text" data-i18n="unit1Title">Unit 1: Arithmetic & Number Properties</h3>
                            <p class="course-meta" data-i18n="unitTopicsCount">5 Topics</p>
                        </div>
                        <i class="fas fa-chevron-down expand-icon ml-4"></i>
                    </div>
                    <div class="course-content">
                        <div class="unit-item">
                            <ul class="topic-list">
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic1_1">Place Value & Number Types</span>
                                    <span class="topic-item-status text-green-600"><i class="fas fa-check-circle mr-1"></i> <span data-i18n="statusCompleted">Completed</span></span>
                                    <button class="topic-action-btn" data-i18n="btnReview">Review</button>
                                </li>
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic1_2">Factors, Multiples & Divisibility</span>
                                    <span class="topic-item-status text-amber-600"><i class="fas fa-clock mr-1"></i> <span data-i18n="statusInProgress">In Progress</span></span>
                                    <button class="topic-action-btn" data-i18n="btnResume">Resume</button>
                                </li>
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic1_3">Fractions, Decimals & Percents</span>
                                    <span class="topic-item-status text-red-600"><i class="fas fa-times-circle mr-1"></i> <span data-i18n="statusNotStarted">Not Started</span></span>
                                    <button class="topic-action-btn" data-i18n="btnStart">Start</button>
                                </li>
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic1_4">Ratio & Proportion</span>
                                    <span class="topic-item-status text-red-600"><i class="fas fa-times-circle mr-1"></i> <span data-i18n="statusNotStarted">Not Started</span></span>
                                    <button class="topic-action-btn" data-i18n="btnStart">Start</button>
                                </li>
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic1_5">Arithmetic Word Problems</span>
                                    <span class="topic-item-status text-red-600"><i class="fas fa-times-circle mr-1"></i> <span data-i18n="statusNotStarted">Not Started</span></span>
                                    <button class="topic-action-btn" data-i18n="btnStart">Start</button>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Unit 2: Algebra & Linear Equations -->
                <div class="course-item">
                    <div class="course-header" data-unit-id="algebra">
                        <div class="course-info">
                            <h3 class="course-title-text" data-i18n="unit2Title">Unit 2: Algebra & Linear Equations</h3>
                            <p class="course-meta" data-i18n="unitTopicsCount2">5 Topics</p>
                        </div>
                        <i class="fas fa-chevron-down expand-icon ml-4"></i>
                    </div>
                    <div class="course-content">
                        <div class="unit-item">
                            <ul class="topic-list">
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic2_1">Solving Linear Equations</span>
                                    <span class="topic-item-status text-red-600"><i class="fas fa-times-circle mr-1"></i> <span data-i18n="statusNotStarted">Not Started</span></span>
                                    <button class="topic-action-btn" data-i18n="btnStart">Start</button>
                                </li>
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic2_2">Inequalities</span>
                                    <span class="topic-item-status text-red-600"><i class="fas fa-times-circle mr-1"></i> <span data-i18n="statusNotStarted">Not Started</span></span>
                                    <button class="topic-action-btn" data-i18n="btnStart">Start</button>
                                </li>
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic2_3">Linear Word Problems</span>
                                    <span class="topic-item-status text-red-600"><i class="fas fa-times-circle mr-1"></i> <span data-i18n="statusNotStarted">Not Started</span></span>
                                    <button class="topic-action-btn" data-i18n="btnStart">Start</button>
                                </li>
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic2_4">Graphs of Linear Equations</span>
                                    <span class="topic-item-status text-red-600"><i class="fas fa-times-circle mr-1"></i> <span data-i18n="statusNotStarted">Not Started</span></span>
                                    <button class="topic-action-btn" data-i18n="btnStart">Start</button>
                                </li>
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic2_5">Systems of Equations</span>
                                    <span class="topic-item-status text-red-600"><i class="fas fa-times-circle mr-1"></i> <span data-i18n="statusNotStarted">Not Started</span></span>
                                    <button class="topic-action-btn" data-i18n="btnStart">Start</button>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Unit 3: Geometry & Measurement -->
                <div class="course-item">
                    <div class="course-header" data-unit-id="geometry">
                        <div class="course-info">
                            <h3 class="course-title-text" data-i18n="unit3Title">Unit 3: Geometry & Measurement</h3>
                            <p class="course-meta" data-i18n="unitTopicsCount3">5 Topics</p>
                        </div>
                        <i class="fas fa-chevron-down expand-icon ml-4"></i>
                    </div>
                    <div class="course-content">
                        <div class="unit-item">
                            <ul class="topic-list">
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic3_1">Area and Perimeter (including Circles)</span>
                                    <span class="topic-item-status text-red-600"><i class="fas fa-times-circle mr-1"></i> <span data-i18n="statusNotStarted">Not Started</span></span>
                                    <button class="topic-action-btn" data-i18n="btnStart">Start</button>
                                </li>
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic3_2">Volume & Surface Area</span>
                                    <span class="topic-item-status text-red-600"><i class="fas fa-times-circle mr-1"></i> <span data-i18n="statusNotStarted">Not Started</span></span>
                                    <button class="topic-action-btn" data-i18n="btnStart">Start</button>
                                </li>
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic3_3">Triangle Properties</span>
                                    <span class="topic-item-status text-red-600"><i class="fas fa-times-circle mr-1"></i> <span data-i18n="statusNotStarted">Not Started</span></span>
                                    <button class="topic-action-btn" data-i18n="btnStart">Start</button>
                                </li>
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic3_4">Coordinate Geometry</span>
                                    <span class="topic-item-status text-red-600"><i class="fas fa-times-circle mr-1"></i> <span data-i18n="statusNotStarted">Not Started</span></span>
                                    <button class="topic-action-btn" data-i18n="btnStart">Start</button>
                                </li>
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic3_5">Angles & Parallel Lines</span>
                                    <span class="topic-item-status text-red-600"><i class="fas fa-times-circle mr-1"></i> <span data-i18n="statusNotStarted">Not Started</span></span>
                                    <button class="topic-action-btn" data-i18n="btnStart">Start</button>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Unit 4: Statistics & Data -->
                <div class="course-item">
                    <div class="course-header" data-unit-id="statistics">
                        <div class="course-info">
                            <h3 class="course-title-text" data-i18n="unit4Title">Unit 4: Statistics & Data</h3>
                            <p class="course-meta" data-i18n="unitTopicsCount4">3 Topics</p>
                        </div>
                        <i class="fas fa-chevron-down expand-icon ml-4"></i>
                    </div>
                    <div class="course-content">
                        <div class="unit-item">
                            <ul class="topic-list">
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic4_1">Mean, Median, Mode, Range</span>
                                    <span class="topic-item-status text-red-600"><i class="fas fa-times-circle mr-1"></i> <span data-i18n="statusNotStarted">Not Started</span></span>
                                    <button class="topic-action-btn" data-i18n="btnStart">Start</button>
                                </li>
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic4_2">Scatterplots & Graph Interpretation</span>
                                    <span class="topic-item-status text-red-600"><i class="fas fa-times-circle mr-1"></i> <span data-i18n="statusNotStarted">Not Started</span></span>
                                    <button class="topic-action-btn" data-i18n="btnStart">Start</button>
                                </li>
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic4_3">Probability</span>
                                    <span class="topic-item-status text-red-600"><i class="fas fa-times-circle mr-1"></i> <span data-i18n="statusNotStarted">Not Started</span></span>
                                    <button class="topic-action-btn" data-i18n="btnStart">Start</button>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Unit 5: Advanced Math (Preview/Optional) -->
                <div class="course-item">
                    <div class="course-header" data-unit-id="advanced-math">
                        <div class="course-info">
                            <h3 class="course-title-text" data-i18n="unit5Title">Unit 5: Advanced Math (Preview/Optional)</h3>
                            <p class="course-meta" data-i18n="unitTopicsCount5">3 Topics</p>
                        </div>
                        <i class="fas fa-chevron-down expand-icon ml-4"></i>
                    </div>
                    <div class="course-content">
                        <div class="unit-item">
                            <ul class="topic-list">
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic5_1">Quadratics (Intro only)</span>
                                    <span class="topic-item-status text-red-600"><i class="fas fa-times-circle mr-1"></i> <span data-i18n="statusNotStarted">Not Started</span></span>
                                    <button class="topic-action-btn" data-i18n="btnStart">Start</button>
                                </li>
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic5_2">Functions (Conceptual, Notation)</span>
                                    <span class="topic-item-status text-red-600"><i class="fas fa-times-circle mr-1"></i> <span data-i18n="statusNotStarted">Not Started</span></span>
                                    <button class="topic-action-btn" data-i18n="btnStart">Start</button>
                                </li>
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic5_3">Exponents & Roots</span>
                                    <span class="topic-item-status text-red-600"><i class="fas fa-times-circle mr-1"></i> <span data-i18n="statusNotStarted">Not Started</span></span>
                                    <button class="topic-action-btn" data-i18n="btnStart">Start</button>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <!-- Section 4: Join a Class -->
        <section id="join-class" class="pb-12"> <!-- Final section, reduced bottom padding -->
            <h2 class="text-2xl lg:text-3xl font-extrabold text-[var(--thelo-text)] mb-6" data-i18n="joinClassSectionTitle">Join Your Teacher's Class</h2>
            
            <div id="class-info-card" class="thelo-card max-w-xl mx-auto flex flex-col items-center">
                <!-- If student is NOT in a class -->
                <div id="not-in-class-state">
                    <p class="text-lg text-slate-600 mb-4" data-i18n="joinClassPrompt">Learning with a teacher?</p>
                    <p class="text-sm text-slate-600 mb-6" data-i18n="joinClassDesc">Join your class with a special code from your instructor.</p>
                    <div class="flex flex-col sm:flex-row gap-3 w-full max-w-sm">
                        <input type="text" id="class-code-input" placeholder="Enter Code" class="flex-grow p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--thelo-blue)]/50" data-i18n="classCodePlaceholder">
                        <button id="join-class-btn" class="thelo-btn flex-shrink-0 px-4 py-2 text-sm" data-i18n="joinBtn">Join Class</button>
                    </div>
                </div>

                <!-- If student IS in a class (hidden by default) -->
                <div id="in-class-state" class="hidden">
                    <h3 class="text-xl font-semibold mb-3" data-i18n="yourClassTitle">Your Class: <span id="class-name" class="text-[var(--thelo-blue)]">Mr. K‚Äôs 10th Grade</span></h3>
                    <p class="text-sm text-slate-600 mb-4" data-i18n="yourClassCode">Code: <span id="class-code" class="font-mono text-slate-700">thelo-xyz10</span></p>
                    <button id="leave-class-btn" class="thelo-btn-secondary mt-2" data-i18n="leaveClassBtn">Leave Class</button>
                </div>
            </div>
        </section>
        
        <!-- User ID Display (for debugging/identification) -->
        <div class="text-center text-sm text-slate-500 mt-12 mb-4">
            <p>Your User ID: <span id="user-id-display" class="font-mono text-slate-700">Loading...</span></p>
        </div>
    </main>

    <!-- Firebase & Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signOut, onAuthStateChanged, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        // Firebase configuration from environment variables
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // DOM Elements
        const studentNameSpan = document.getElementById('student-name');
        const profilePhotoNav = document.getElementById('profile-photo-nav'); 
        const openThelobookBtn = document.getElementById('open-thelobook-btn');
        // const langToggle = document.getElementById('langToggle'); // Removed from DOM
        const userIdDisplay = document.getElementById('user-id-display');

        // Section 1: Welcome & Quick Stats
        const welcomeGreetingSpan = document.getElementById('student-name');
        const studentPointsSpan = document.getElementById('student-points');
        const lessonsCompletedCountSpan = document.getElementById('lessons-completed-count');
        const streakCountSpan = document.getElementById('streak-count');

        // Section 2: Continue Practice
        const inProgressLessonCard = document.getElementById('in-progress-lesson-card');
        const noInProgressMessage = document.getElementById('no-in-progress-message');
        const lastTopicNameSpan = document.getElementById('last-topic-name');
        const problemsCountSpan = document.getElementById('problems-count');
        const progressPercentageSpan = document.getElementById('progress-percentage');
        const lastTopicProgressBar = document.getElementById('last-topic-progress-bar');
        const resumePracticeBtn = document.getElementById('resume-practice-btn');

        // Section 3: Join a Class
        const joinClassPromptSpan = document.getElementById('joinClassPrompt');
        const joinClassDescSpan = document.getElementById('joinClassDesc');
        const classCodeInput = document.getElementById('class-code-input');
        const joinClassBtn = document.getElementById('join-class-btn');
        const inClassStateDiv = document.getElementById('in-class-state');
        const notInClassStateDiv = document.getElementById('not-in-class-state');
        const classNameSpan = document.getElementById('class-name');
        const classCodeSpan = document.getElementById('class-code');
        const leaveClassBtn = document.getElementById('leave-class-btn');


        let isAuthReady = false; 

        // --- Internationalization Strings ---
        const strings = {
            en: {
                dashboardTitle: 'Thelo Student Dashboard',
                welcomeGreeting: 'Good afternoon, <span id="student-name">Student</span>!',
                pointsTitle: 'Points', // New
                lessonsCompletedTitle: 'Lessons Completed', // New
                streakTitle: 'Current Streak', // New
                pointsDisplay: 'Points', // Renamed for better string usage (value comes from JS)
                lessonsCompletedDisplay: 'Lessons', // Renamed
                streakDisplay: 'Streak: <span id="streak-count" class="text-[var(--thelo-blue)]">0</span> üî•',
                
                // Section 2: Continue Practice
                continuePracticeTitle: 'Continue Practice',
                lastTopicContext: 'Last Topic: <span class="font-semibold text-[var(--thelo-blue)]" id="last-topic-name">Area of Circles</span>',
                topicStats: '<span id="problems-count">0</span> Problems ‚Ä¢ <span id="progress-percentage">0%</span> Complete',
                resumePracticeBtn: 'Resume Practice',
                noInProgressMessage: 'No in-progress lessons. Start a new topic below!',

                // Section 3: SAT Math Units (Bulk Practice)
                satMathUnitsTitle: 'SAT Math Units (Bulk Practice)',
                unit1Title: 'Unit 1: Arithmetic & Number Properties',
                unitTopicsCount: '5 Topics',
                topic1_1: 'Place Value & Number Types',
                topic1_2: 'Factors, Multiples & Divisibility',
                topic1_3: 'Fractions, Decimals & Percents',
                topic1_4: 'Ratio & Proportion',
                topic1_5: 'Arithmetic Word Problems',
                unit2Title: 'Unit 2: Algebra & Linear Equations',
                unitTopicsCount2: '5 Topics',
                topic2_1: 'Solving Linear Equations',
                topic2_2: 'Inequalities',
                topic2_3: 'Linear Word Problems',
                topic2_4: 'Graphs of Linear Equations',
                topic2_5: 'Systems of Equations',
                unit3Title: 'Unit 3: Geometry & Measurement',
                unitTopicsCount3: '5 Topics',
                topic3_1: 'Area and Perimeter (including Circles)',
                topic3_2: 'Volume & Surface Area',
                topic3_3: 'Triangle Properties',
                topic3_4: 'Coordinate Geometry',
                topic3_5: 'Angles & Parallel Lines',
                unit4Title: 'Unit 4: Statistics & Data',
                unitTopicsCount4: '3 Topics',
                topic4_1: 'Mean, Median, Mode, Range',
                topic4_2: 'Scatterplots & Graph Interpretation',
                topic4_3: 'Probability',
                unit5Title: 'Unit 5: Advanced Math (Preview/Optional)',
                unitTopicsCount5: '3 Topics',
                topic5_1: 'Quadratics (Intro only)',
                topic5_2: 'Functions (Conceptual, Notation)',
                topic5_3: 'Exponents & Roots',
                statusCompleted: 'Completed',
                statusInProgress: 'In Progress',
                statusNotStarted: 'Not Started',
                btnReview: 'Review',
                btnResume: 'Resume',
                btnStart: 'Start',

                // Section 4: Join a Class
                joinClassSectionTitle: 'Join Your Teacher\'s Class',
                joinClassPrompt: 'Learning with a teacher?',
                joinClassDesc: 'Join your class with a special code from your instructor.',
                classCodePlaceholder: 'Enter Code',
                joinBtn: 'Join Class',
                yourClassTitle: 'Your Class: <span id="class-name" class="text-[var(--thelo-blue)]">Mr. K‚Äôs 10th Grade</span>',
                yourClassCode: 'Code: <span id="class-code" class="font-mono text-slate-700">thelo-xyz10</span>',
                leaveClassBtn: 'Leave Class',

                settingsBtn: 'Settings', // Title for profile photo acting as settings
                openThelobookBtn: 'thelobook',
                thelobookBtnText: 'thelobook' // New string for Thelobook button text
            },
            hy: {
                dashboardTitle: '‘π’•’¨’∏ ’à÷Ç’Ω’°’∂’∏’≤’´ ’é’°’∞’°’∂’°’Ø',
                welcomeGreeting: '‘≤’°÷Ä’´ ’Ø’•’Ω÷Ö÷Ä, <span id="student-name">’à÷Ç’Ω’°’∂’∏’≤</span>!',
                pointsTitle: '’Ñ’´’°’æ’∏÷Ä’∂’•÷Ä',
                lessonsCompletedTitle: '‘±’æ’°÷Ä’ø’æ’°’Æ ’§’°’Ω’•÷Ä',
                streakTitle: '‘∏’∂’©’°÷Å’´’Ø ’∑’°÷Ä’∏÷Ç’∂’°’Ø’°’Ø’°’∂’∏÷Ç’©’µ’∏÷Ç’∂',
                pointsDisplay: '’Ñ’´’°’æ’∏÷Ä’∂’•÷Ä',
                lessonsCompletedDisplay: '‘¥’°’Ω’•÷Ä',
                streakDisplay: '’á’°÷Ä’∏÷Ç’∂’°’Ø’°’Ø’°’∂’∏÷Ç’©’µ’∏÷Ç’∂: <span id="streak-count" class="text-[var(--thelo-blue)]">0</span> üî•',

                continuePracticeTitle: '’á’°÷Ä’∏÷Ç’∂’°’Ø’•’¨ ‘≥’∏÷Ä’Æ’∂’°’Ø’°’∂ ‘±’∑’≠’°’ø’°’∂÷Ñ’®',
                lastTopicContext: '’é’•÷Ä’ª’´’∂ ’©’•’¥’°’∂: <span class="font-semibold text-[var(--thelo-blue)]" id="last-topic-name">’á÷Ä’ª’°’∂’∂’•÷Ä’´ ’Ñ’°’Ø’•÷Ä’•’Ω’®</span>',
                topicStats: '<span id="problems-count">0</span> ‘Ω’∂’§’´÷Ä’∂’•÷Ä ‚Ä¢ <span id="progress-percentage">0%</span> ‘±’æ’°÷Ä’ø’æ’°’Æ',
                resumePracticeBtn: '’á’°÷Ä’∏÷Ç’∂’°’Ø’•’¨ ‘≥’∏÷Ä’Æ’∂’°’Ø’°’∂ ‘±’∑’≠’°’ø’°’∂÷Ñ’®',
                noInProgressMessage: '’â’Ø’°’∂ ’®’∂’©’°÷Å÷Ñ’´ ’¥’•’ª ’£’ø’∂’æ’∏’≤ ’§’°’Ω’•÷Ä÷â ’ç’Ø’Ω’•÷Ñ ’∂’∏÷Ä ’©’•’¥’° ’∂’•÷Ä÷Ñ÷á’´÷Å÷â',

                satMathUnitsTitle: 'SAT ’Ñ’°’©’•’¥’°’ø’´’Ø’°’µ’´ ’Ñ’∏’§’∏÷Ç’¨’∂’•÷Ä (‘∂’°’∂’£’æ’°’Æ’°’µ’´’∂ ‘≥’∏÷Ä’Æ’∂’°’Ø’°’∂ ‘±’∑’≠’°’ø’°’∂÷Ñ)',
                unit1Title: '’Ñ’∏’§’∏÷Ç’¨ 1: ‘π’æ’°’¢’°’∂’∏÷Ç’©’µ’∏÷Ç’∂ ÷á ’©’æ’°’µ’´’∂ ’∞’°’ø’Ø’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä',
                unitTopicsCount: '5 ‘π’•’¥’°',
                topic1_1: '‘ø’°÷Ä’£’°’µ’´’∂ ’°÷Ä’™’•÷Ñ ÷á ’©’æ’•÷Ä’´ ’ø’•’Ω’°’Ø’∂’•÷Ä',
                topic1_2: '‘≥’∏÷Ä’Æ’°’Ø’´÷Å’∂’•÷Ä, ’¢’°’¶’¥’°’∫’°’ø’´’Ø’∂’•÷Ä ÷á ’¢’°’™’°’∂’°÷Ä’°÷Ä’∏÷Ç’©’µ’∏÷Ç’∂',
                topic1_3: '‘ø’∏’ø’∏÷Ä’°’Ø’∂’•÷Ä, ’ø’°’Ω’∂’∏÷Ä’§’°’Ø’°’∂’∂’•÷Ä ÷á ’ø’∏’Ø’∏’Ω’∂’•÷Ä',
                topic1_4: '’Ä’°÷Ä’°’¢’•÷Ä’∏÷Ç’©’µ’∏÷Ç’∂ ÷á ’∞’°’¥’°’¥’°’Ω’∂’∏÷Ç’©’µ’∏÷Ç’∂',
                topic1_5: '‘π’æ’°’¢’°’∂’°’Ø’°’∂ ’¢’°’º’°’µ’´’∂ ’≠’∂’§’´÷Ä’∂’•÷Ä',
                unit2Title: '’Ñ’∏’§’∏÷Ç’¨ 2: ’Ä’°’∂÷Ä’°’∞’°’∑’´’æ ÷á ‘≥’Æ’°’µ’´’∂ ’Ä’°’æ’°’Ω’°÷Ä’∏÷Ç’¥’∂’•÷Ä',
                unitTopicsCount2: '5 ‘π’•’¥’°',
                topic2_1: '‘≥’Æ’°’µ’´’∂ ’∞’°’æ’°’Ω’°÷Ä’∏÷Ç’¥’∂’•÷Ä’´ ’¨’∏÷Ç’Æ’∏÷Ç’¥',
                topic2_2: '‘±’∂’∞’°’æ’°’Ω’°÷Ä’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä',
                topic2_3: '‘≥’Æ’°’µ’´’∂ ’¢’°’º’°’µ’´’∂ ’≠’∂’§’´÷Ä’∂’•÷Ä',
                topic2_4: '‘≥’Æ’°’µ’´’∂ ’∞’°’æ’°’Ω’°÷Ä’∏÷Ç’¥’∂’•÷Ä’´ ’£÷Ä’°÷Ü’´’Ø’∂’•÷Ä',
                topic2_5: '’Ä’°’æ’°’Ω’°÷Ä’∏÷Ç’¥’∂’•÷Ä’´ ’∞’°’¥’°’Ø’°÷Ä’£’•÷Ä',
                unit3Title: '’Ñ’∏’§’∏÷Ç’¨ 3: ‘µ÷Ä’Ø÷Ä’°’π’°÷É’∏÷Ç’©’µ’∏÷Ç’∂ ÷á ’π’°÷É’∏÷Ç’¥',
                unitTopicsCount3: '5 ‘π’•’¥’°',
                topic3_1: '’Ñ’°’Ø’•÷Ä’•’Ω ÷á ’∫’°÷Ä’°’£’´’Æ (’∂’•÷Ä’°’º’µ’°’¨ ’∑÷Ä’ª’°’∂’∂’•÷Ä)',
                topic3_2: '‘æ’°’æ’°’¨ ÷á ’¥’°’Ø’•÷Ä’•’Ω',
                topic3_3: '‘µ’º’°’∂’Ø’µ’∏÷Ç’∂’∂’•÷Ä’´ ’∞’°’ø’Ø’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä',
                topic3_4: '‘ø’∏’∏÷Ä’§’´’∂’°’ø’°’µ’´’∂ ’•÷Ä’Ø÷Ä’°’π’°÷É’∏÷Ç’©’µ’∏÷Ç’∂',
                topic3_5: '‘±’∂’Ø’µ’∏÷Ç’∂’∂’•÷Ä ÷á ’¶’∏÷Ç’£’°’∞’•’º ’∏÷Ç’≤’´’≤’∂’•÷Ä',
                unit4Title: '’Ñ’∏’§’∏÷Ç’¨ 4: ’é’´’≥’°’Ø’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂ ÷á ’ø’æ’µ’°’¨’∂’•÷Ä',
                unitTopicsCount4: '3 ‘π’•’¥’°',
                topic4_1: '’Ñ’´’ª’´’∂, ’¥’´’ª’∂’°÷Ä’™’•÷Ñ, ’¥’∏’§’°, ’¥’´’ª’°’Ø’°’µ÷Ñ',
                topic4_2: '’ë÷Ä’¥’°’∂ ’£÷Ä’°÷Ü’´’Ø’∂’•÷Ä ÷á ’£÷Ä’°÷Ü’´’Ø’∂’•÷Ä’´ ’¥’•’Ø’∂’°’¢’°’∂’∏÷Ç’¥',
                topic4_3: '’Ä’°’æ’°’∂’°’Ø’°’∂’∏÷Ç’©’µ’∏÷Ç’∂',
                unit5Title: '’Ñ’∏’§’∏÷Ç’¨ 5: ‘∏’∂’§’¨’°’µ’∂’æ’°’Æ ’Ñ’°’©’•’¥’°’ø’´’Ø’° (’Ñ’´’°’µ’∂ ’Ü’°’≠’°’§’´’ø’∏÷Ç’¥)',
                unitTopicsCount5: '3 ‘π’•’¥’°',
                topic5_1: '’î’°’º’°’Ø’∏÷Ç’Ω’´ (’Ñ’´’°’µ’∂ ’∂’•÷Ä’°’Æ’∏÷Ç’©’µ’∏÷Ç’∂)',
                topic5_2: '’ñ’∏÷Ç’∂’Ø÷Å’´’°’∂’•÷Ä (’Ä’°’µ’•÷Å’°’Ø’°÷Ä’£’°’µ’´’∂, ’∂’∑’∏÷Ç’¥)',
                topic5_3: '‘±’Ω’ø’´’≥’°’∂’∂’•÷Ä ÷á ’°÷Ä’¥’°’ø’∂’•÷Ä',
                statusCompleted: '‘±’æ’°÷Ä’ø’æ’°’Æ',
                statusInProgress: '‘∏’∂’©’°÷Å÷Ñ’´ ’¥’•’ª',
                statusNotStarted: '’â’Ω’Ø’Ω’æ’°’Æ',
                btnReview: '’é’•÷Ä’°’∂’°’µ’•’¨',
                btnResume: '’á’°÷Ä’∏÷Ç’∂’°’Ø’•’¨',
                btnStart: '’ç’Ø’Ω’•’¨',

                joinClassSectionTitle: '’Ñ’´’°÷Å’•÷Ñ ’Å’•÷Ä ’à÷Ç’Ω’∏÷Ç÷Å’π’´ ‘¥’°’Ω’°÷Ä’°’∂’´’∂',
                joinClassPrompt: '’ç’∏’æ’∏÷Ä’∏÷Ç’û’¥ ’•÷Ñ ’∏÷Ç’Ω’∏÷Ç÷Å’π’´ ’∞’•’ø÷â',
                joinClassDesc: '’Ñ’´’°÷Å’•÷Ñ ’±’•÷Ä ’§’°’Ω’°÷Ä’°’∂’´’∂’ù ’¥’∏÷Ç’ø÷Ñ’°’£÷Ä’•’¨’∏’æ ’±’•÷Ä ’∏÷Ç’Ω’∏÷Ç÷Å’π’´ ’∞’°’ø’∏÷Ç’Ø ’Ø’∏’§’®÷â',
                classCodePlaceholder: '’Ñ’∏÷Ç’ø÷Ñ’°’£÷Ä’•÷Ñ ‘ø’∏’§’®',
                joinBtn: '’Ñ’´’°’∂’°’¨ ‘¥’°’Ω’°÷Ä’°’∂’´’∂',
                yourClassTitle: '’Å’•÷Ä ‘¥’°’Ω’°÷Ä’°’∂’®: <span id="class-name" class="text-[var(--thelo-blue)]">’ä÷Ä’∂. ’î’•’µ’´ 10-÷Ä’§ ’§’°’Ω’°÷Ä’°’∂</span>',
                yourClassCode: '‘ø’∏’§’®: <span id="class-code" class="font-mono text-slate-700">thelo-xyz10</span>',
                leaveClassBtn: '‘¥’∏÷Ç÷Ä’Ω ’£’°’¨ ’§’°’Ω’°÷Ä’°’∂’´÷Å',

                settingsBtn: '‘ø’°÷Ä’£’°’æ’∏÷Ä’∏÷Ç’¥’∂’•÷Ä',
                openThelobookBtn: '‘π’•’¨’∏’£’´÷Ä÷Ñ',
                thelobookBtnText: '‘π’•’¨’∏’£’´÷Ä÷Ñ' // New string for Thelobook button text
            }
        };

        let currentLang = 'en'; // Default language state

        function applyLang(lang) {
            document.documentElement.lang = lang;
            const t = strings[lang] || strings.en;
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const k = el.dataset.i18n;
                if (t[k]) {
                    el.innerHTML = t[k]; 
                }
            });
            
            // Retain dynamic content after language switch
            if (studentNameSpan) studentNameSpan.textContent = studentNameSpan.textContent;
            if (studentPointsSpan) studentPointsSpan.textContent = studentPointsSpan.textContent;
            if (lessonsCompletedCountSpan) lessonsCompletedCountSpan.textContent = lessonsCompletedCountSpan.textContent;
            if (streakCountSpan) streakCountSpan.textContent = streakCountSpan.textContent;
            if (lastTopicNameSpan) lastTopicNameSpan.textContent = lastTopicNameSpan.textContent;
            if (problemsCountSpan) problemsCountSpan.textContent = problemsCountSpan.textContent;
            if (progressPercentageSpan) progressPercentageSpan.textContent = progressPercentageSpan.textContent;
            if (classNameSpan) classNameSpan.textContent = classNameSpan.textContent;
            if (classCodeSpan) classCodeSpan.textContent = classCodeSpan.textContent;


            // Update placeholder text for search input
            const searchInput = document.querySelector('input[placeholder="Search lessons..."]');
            if (searchInput) {
                searchInput.placeholder = t.classCodePlaceholder || searchInput.placeholder; // Reusing for class code for now
            }

            // Update thelobook button text
            const thelobookBtnTextElement = document.querySelector('#open-thelobook-btn span[data-i18n="thelobookBtnText"]');
            if (thelobookBtnTextElement) {
                thelobookBtnTextElement.textContent = t.thelobookBtnText;
            }
            
            // Update settings button title for accessibility
            const profilePhoto = document.getElementById('profile-photo-nav'); // Get reference
            if (profilePhoto) {
                profilePhoto.title = t.settingsBtn; 
            }
        }

        // Fetch user data and update dashboard
        async function updateDashboard(user) {
            if (!db) {
                console.error("Firestore is not initialized.");
                return;
            }

            const userIdDisplayElement = document.getElementById('user-id-display');
            if (userIdDisplayElement) {
                userIdDisplayElement.textContent = user.uid;
            }

            const userProfileRef = doc(db, 'artifacts', appId, 'users', user.uid, 'user_profile', 'profile');
            try {
                const docSnap = await getDoc(userProfileRef);
                if (docSnap.exists()) {
                    const userData = docSnap.data();
                    const userName = userData.name || 'Student';
                    
                    if (studentNameSpan) studentNameSpan.textContent = userName;

                    // Update profile photo in navbar if PFP URL exists
                    const profilePhoto = document.getElementById('profile-photo-nav');
                    if (profilePhoto && userData.pfpUrl) {
                        profilePhoto.src = userData.pfpUrl;
                    }

                    // --- Simulate Dashboard Data ---
                    const simulatedPoints = Math.floor(Math.random() * 1000) + 100;
                    const simulatedLessonsCompleted = Math.floor(Math.random() * 30) + 5;
                    const simulatedStreak = Math.floor(Math.random() * 10) + 1; // 1-10 day streak
                    
                    if (studentPointsSpan) studentPointsSpan.textContent = simulatedPoints;
                    if (lessonsCompletedCountSpan) lessonsCompletedCountSpan.textContent = simulatedLessonsCompleted;
                    if (streakCountSpan) streakCountSpan.textContent = simulatedStreak;

                    // Simulate In-Progress Lesson (show/hide section)
                    const hasInProgressLesson = Math.random() > 0.5; // 50% chance of in-progress
                    if (hasInProgressLesson) {
                        if (inProgressLessonCard) inProgressLessonCard.classList.remove('hidden');
                        if (noInProgressMessage) noInProgressMessage.classList.add('hidden');
                        if (lastTopicNameSpan) lastTopicNameSpan.textContent = "Solving Linear Equations"; // Example topic
                        if (problemsCountSpan) problemsCountSpan.textContent = "4"; // Example
                        const progress = Math.floor(Math.random() * 90) + 5; // 5-95%
                        if (progressPercentageSpan) progressPercentageSpan.textContent = `${progress}%`;
                        if (lastTopicProgressBar) lastTopicProgressBar.style.width = `${progress}%`;
                    } else {
                        if (inProgressLessonCard) inProgressLessonCard.classList.add('hidden');
                        if (noInProgressMessage) noInProgressMessage.classList.remove('hidden');
                    }

                    // Simulate Class Join Status
                    const isInClass = Math.random() > 0.5; // 50% chance of being in a class
                    if (isInClass) {
                        if (inClassStateDiv) inClassStateDiv.classList.remove('hidden');
                        if (notInClassStateDiv) notInClassStateDiv.classList.add('hidden');
                        if (classNameSpan) classNameSpan.textContent = "Mr. K‚Äôs 10th Grade"; // Example class
                        if (classCodeSpan) classCodeSpan.textContent = "thelo-xyz10"; // Example code
                    } else {
                        if (inClassStateDiv) inClassStateDiv.classList.add('hidden');
                        if (notInClassStateDiv) notInClassStateDiv.classList.remove('hidden');
                    }

                } else {
                    console.warn("No user profile found for UID:", user.uid);
                    if (studentNameSpan) studentNameSpan.textContent = 'New Student';
                    // Hide in-progress and show no-progress message by default for new users
                    if (inProgressLessonCard) inProgressLessonCard.classList.add('hidden');
                    if (noInProgressMessage) noInProgressMessage.classList.remove('hidden');
                    // Ensure not in class by default for new users
                    if (inClassStateDiv) inClassStateDiv.classList.add('hidden');
                    if (notInClassStateDiv) notInClassStateDiv.classList.remove('hidden');
                }
            } catch (error) {
                console.error("Error fetching user profile:", error);
                if (studentNameSpan) studentNameSpan.textContent = 'Student'; // Fallback on error
                if (inProgressLessonCard) inProgressLessonCard.classList.add('hidden');
                if (noInProgressMessage) noInProgressMessage.classList.remove('hidden');
                if (inClassStateDiv) inClassStateDiv.classList.add('hidden');
                if (notInClassStateDiv) notInClassStateDiv.classList.remove('hidden');
            }
            applyLang(currentLang); // Re-apply lang to ensure dynamic spans are translated
        }

        // Firebase Auth State Listener
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                console.log("User is authenticated:", user.uid);
                // If it's a Canvas custom token, try to sign in with it if not already signed in.
                // Otherwise, if already authenticated (e.g., via email/password), proceed.
                if (typeof __initial_auth_token !== 'undefined' && !isAuthReady) {
                    try {
                        await signInWithCustomToken(auth, __initial_auth_token);
                        console.log("Signed in with initial custom token.");
                        await updateDashboard(auth.currentUser); // Use auth.currentUser after potential sign-in
                    } catch (error) {
                        console.error("Error signing in with initial custom token:", error);
                        await signInAnonymously(auth); // Fallback to anonymous if custom token fails
                        console.log("Signed in anonymously after custom token failure.");
                        await updateDashboard(auth.currentUser); // Update dashboard for anonymous user
                    }
                } else if (!isAuthReady) {
                    // For users authenticated via email/password (not Canvas token initially)
                    await updateDashboard(user);
                } else if (user.isAnonymous && !isAuthReady) {
                    // If already anonymous and not ready, proceed to update (this state might happen
                    // if anonymous sign-in happened on a previous page load or in a race condition)
                    console.log("User already anonymous. Proceeding to update dashboard.");
                    await updateDashboard(user);
                }

            } else {
                console.log("No user authenticated. Redirecting to login.");
                // Redirect only if Firebase auth state has been fully checked and no user found
                if (isAuthReady) { 
                     window.location.href = 'index.html'; // Redirect to your main login page
                }
            }
            isAuthReady = true; // Mark auth state as ready after initial check
        });

        // Profile Photo (Settings) button functionality
        if (profilePhotoNav) {
            profilePhotoNav.addEventListener('click', () => {
                window.location.href = 'student-settings.html'; // Redirect to the settings page
            });
        }
        
        // Initial language application and event listeners on DOMContentLoaded
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            currentLang = params.get('lang') || 'en';
            applyLang(currentLang); // Apply language initially
            
            // Language toggle listener (Removed from DOM, so this block is now redundant on dashboard)
            /*
            const langToggleButton = document.getElementById('langToggle'); 
            if (langToggleButton) {
                langToggleButton.addEventListener('click', () => {
                    currentLang = (currentLang === 'en') ? 'hy' : 'en';
                    const url = new URL(window.location);
                    url.searchParams.set('lang', currentLang);
                    window.history.replaceState({}, '', url);
                    applyLang(currentLang);
                });
            }
            */

            // Accordion functionality for Units
            document.querySelectorAll('.course-header').forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling;  
                    
                    // Toggle 'active' class on course-content for visibility
                    content.classList.toggle('active');

                    // Toggle 'expanded' class on header for icon rotation
                    header.classList.toggle('expanded');

                    // Set maxHeight for smooth transition (optional, but good for visual effect)
                    if (content.classList.contains('active')) {
                        content.style.maxHeight = content.scrollHeight + "px";
                    } else {
                        content.style.maxHeight = null;
                    }
                });
            });

            // Handle actions for topics (Start, Resume, Review)
            document.querySelectorAll('.topic-action-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    event.stopPropagation(); // Prevent accordion from toggling when button is clicked
                    const topicName = event.target.closest('.topic-item').querySelector('.topic-item-name').textContent;
                    const action = event.target.textContent.trim();
                    alert(`${action} Topic: ${topicName}`); // Placeholder for actual action
                });
            });

            // Resume Practice Button (if it exists)
            if (resumePracticeBtn) {
                resumePracticeBtn.addEventListener('click', () => {
                    const topicName = lastTopicNameSpan ? lastTopicNameSpan.textContent : "your last topic";
                    alert(`Resuming practice for: ${topicName}!`);
                });
            }
            
            // Join Class Button (if it exists)
            if (joinClassBtn) {
                joinClassBtn.addEventListener('click', () => {
                    const classCodeInput = document.getElementById('class-code-input');
                    alert(`Attempting to join class with code: ${classCodeInput.value}`);
                    // Add actual logic to join class
                });
            }

            // Leave Class Button (if it exists)
            if (leaveClassBtn) {
                leaveClassBtn.addEventListener('click', () => {
                    const className = classNameSpan ? classNameSpan.textContent : "your class";
                    alert(`Attempting to leave: ${className}!`);
                    // Add actual logic to leave class
                    // For demo, just toggle back to not-in-class state
                    if (inClassStateDiv) inClassStateDiv.classList.add('hidden');
                    if (notInClassStateDiv) notInClassStateDiv.classList.remove('hidden');
                });
            }
        });
    </script>
</body>
</html>
