<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="dashboardTitle">Thelo Student Dashboard</title>
    <link rel="icon" href="https://thelo.space/img/thelofavicon.png" type="image/png" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;700;800&family=Noto+Serif+Armenian:wght@400;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

    <style>
        :root {
            --thelo-blue: #2563EB;
            --thelo-bg: #F8F9FA; /* This is the base background for the grid itself */
            --thelo-text: #111827;
            --grid-color: #E5E7EB;
            --card-hover-shadow: 0 8px 15px rgba(0, 0, 0, 0.08); /* Slightly lighter hover shadow */
        }

        html {
            scroll-behavior: smooth;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        body {
            font-family: 'Manrope', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--thelo-bg);
            color: var(--thelo-text);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            
            /* The signature grid background directly on the body */
            background-image:
                linear-gradient(to right, var(--grid-color) 1px, transparent 1px),
                linear-gradient(to bottom, var(--grid-color) 1px, transparent 1px);
            background-size: 40px 40px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 0; /* Ensure no default body padding */
            margin: 0; /* Ensure no default body margin */
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        /* Language-specific font rules */
        html[lang="en"] body {
            font-family: 'Manrope', sans-serif;
        }
        html[lang="hy"] body {
            font-family: "Noto Serif Armenian", serif;
        }

        h1, h2, h3, h4, h5, h6 {
            font-weight: 800; /* Bolder Manrope */
        }
        html[lang="hy"] h1, 
        html[lang="hy"] h2, 
        html[lang="hy"] h3, 
        html[lang="hy"] h4, 
        html[lang="hy"] h5, 
        html[lang="hy"] h6 {
            font-weight: 700; /* Bolder Noto Serif Armenian */
        }

        /* Header (Minimalist and Transparent) */
        header {
            background-color: transparent; /* No white box on navbar */
            backdrop-filter: none; /* No blur */
            border-bottom: none; /* No border */
            padding: 1.5rem 2.5rem; /* Enhanced padding from borders */
            display: flex;
            justify-content: space-between; /* Space out logo and right section */
            align-items: center;
            width: 100%;
            z-index: 10; /* Ensure it stays on top */
            position: relative;
        }
        
        /* Main Content Area */
        main {
            flex-grow: 1;
            padding: 3rem 2.5rem; /* Enhanced overall padding for main content */
            max-width: 1400px; /* Wider content area */
            margin: 0 auto; /* Center content */
            overflow-x: hidden; /* Ensure main content does not cause horizontal scroll */
        }
        section {
            margin-bottom: 4rem; /* Standard space between sections */
        }

        /* Card Style (General purpose for progress, topic, course) */
        .thelo-card {
            background-color: white; /* White background for individual cards */
            border: 1px solid var(--grid-color);
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            padding: 2rem; /* Increased padding within cards */
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; /* Add transition for hover */
        }

        .thelo-card:hover {
            transform: translateY(-5px); /* Lift card on hover */
            box-shadow: var(--card-hover-shadow); /* Stronger shadow on hover */
        }

        /* Primary Button Style */
        .thelo-btn {
            background-color: var(--thelo-blue);
            color: white;
            font-weight: 700;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .thelo-btn:hover {
            background-color: #1a56d2;
            transform: translateY(-2px);
        }

        /* Secondary Button Style */
        .thelo-btn-secondary {
            background-color: transparent;
            color: var(--thelo-blue);
            border: 1px solid var(--thelo-blue);
            font-weight: 700;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .thelo-btn-secondary:hover {
            background-color: var(--thelo-blue);
            color: white;
        }

        /* Progress Bar */
        .progress-bar-container {
            width: 100%;
            background-color: var(--grid-color);
            border-radius: 0.5rem;
            overflow: hidden;
        }
        .progress-bar {
            height: 10px;
            background-color: var(--thelo-blue);
            border-radius: 0.5rem;
            transition: width 0.5s ease-in-out;
        }

        /* Specific styles for elements within new structure */
        .topic-card-context {
            font-size: 0.85rem; 
            color: #6B7280;
            margin-bottom: 0.5rem;
        }

        /* Course Item Styling (accordion header) */
        .course-item {
            background-color: white;
            border: 1px solid var(--grid-color);
            border-radius: 0.75rem;
            margin-bottom: 1rem; /* Space between courses */
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }

        .course-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem 2rem;
            cursor: pointer;
            font-weight: 700;
            color: var(--thelo-text);
            transition: background-color 0.2s ease-in-out;
        }
        .course-header:hover {
            background-color: #F3F4F6; /* light gray hover */
        }

        .course-header .course-info {
            flex-grow: 1;
        }

        .course-header .course-title-text {
            font-size: 1.25rem; /* text-xl */
            font-weight: 800;
        }

        .course-header .course-meta {
            font-size: 0.9rem;
            color: #6B7280;
            margin-top: 0.5rem;
        }
        
        .course-header .expand-icon {
            margin-left: 1.5rem;
            transition: transform 0.3s ease-in-out;
        }
        .course-header.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .course-content {
            padding: 0 2rem 1.5rem 2rem;
            display: none; /* Hidden by default */
        }
        .course-content.active {
            display: block;
        }

        .unit-item {
            background-color: var(--thelo-bg); /* Use thelo-bg for units */
            border: 1px solid #D1D5DB; /* Slightly darker border for units */
            border-radius: 0.5rem;
            margin-top: 1rem;
            padding: 1rem 1.5rem;
        }
        .unit-title {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.75rem;
        }
        .topic-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .topic-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px dashed #E5E7EB; /* Dashed separator */
            font-size: 0.95rem;
        }
        .topic-item:last-child {
            border-bottom: none;
        }
        .topic-item-name {
            flex-grow: 1; /* Allow name to take space */
            margin-right: 1rem; /* Space before status/button */
        }
        .topic-item-status {
            font-weight: 600;
            margin-left: 1rem;
            min-width: 100px; /* Give status some room */
            text-align: right;
        }
        .topic-item-status .fa-check-circle { color: #10B981; /* Green */ }
        .topic-item-status .fa-clock { color: #F59E0B; /* Amber */ }
        .topic-item-status .fa-times-circle { color: #EF4444; /* Red */ }

        .topic-action-btn {
            background-color: var(--thelo-blue);
            color: white;
            font-weight: 600;
            padding: 0.4rem 0.8rem;
            border-radius: 0.3rem;
            transition: background-color 0.2s ease-in-out;
            margin-left: 1rem; /* Space between status and button */
        }
        .topic-action-btn:hover {
            background-color: #1a56d2;
        }

        /* Profile Photo in Navbar */
        .profile-photo-nav {
            width: 40px; 
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.2s ease-in-out, transform 0.2s ease-in-out;
        }
        .profile-photo-nav:hover {
            border-color: var(--thelo-blue);
            transform: scale(1.05);
        }

        /* Thelobook button in Navbar */
        .thelobook-nav-btn {
            background-color: transparent;
            color: var(--thelo-text);
            font-weight: 700;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: color 0.2s, background-color 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .thelobook-nav-btn:hover {
            color: var(--thelo-blue);
            background-color: rgba(37, 99, 235, 0.1);
        }
        
        /* Specific Styles for Achievements/Encouragement Section */
        .achievement-card {
            background-color: white;
            border: 1px solid var(--grid-color);
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .achievement-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-hover-shadow);
        }
        .achievement-icon {
            font-size: 3rem;
            color: var(--thelo-blue);
            margin-bottom: 1rem;
        }
        .achievement-message {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--thelo-text);
        }
        .achievement-description {
            font-size: 1rem;
            color: #6B7280;
            margin-top: 0.5rem;
        }

        /* Removed floating utility actions (Quick Practice) */
        #utility-actions {
            display: none; 
        }

        /* macOS style window buttons on the Welcome section heading */
        #welcome-overview::before {
            content: ' ';
            position: absolute; /* Needs parent with position: relative */
            top: 2rem; /* Adjusted for better visual alignment within section */
            left: 2rem;
            width: 52px;
            height: 12px;
            background-image: url("data:image/svg+xml,%3Csvg width='52' height='12' viewBox='0 0 52 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='6' cy='6' r='6' fill='%23FF5F56'/%3E%3Ccircle cx='26' cy='6' r='6' fill='%23FFBD2E'/%3E%3Ccircle cx='46' cy='6' r='6' fill='%2327C93F'/%3E%3C/svg%3E%0A");
            background-repeat: no-repeat;
            z-index: 10;
        }
        /* Make welcome-overview section relative for absolute positioning of dots */
        #welcome-overview {
            position: relative;
            padding-top: 3.5rem; /* Add extra padding to make space for dots */
        }
        #welcome-overview h2 {
            margin-top: 0; /* Remove top margin if padding is used on parent */
        }

        /* Mobile adjustments */
        @media (max-width: 767px) {
            header {
                padding: 1rem 1.5rem; /* Reduced header padding */
                flex-direction: row; 
                justify-content: space-between; 
                align-items: center;
            }
            header > div:last-child { 
                width: auto;
                margin-top: 0;
            }
            main {
                padding: 1.5rem; 
            }
            section {
                margin-bottom: 3rem; 
            }
            .thelo-card {
                padding: 1.25rem;
            }
            .dashboard-grid { /* Not directly used for current cards, but kept for general grid */
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            .course-header {
                padding: 1rem 1.5rem;
                flex-wrap: wrap; 
            }
            .course-header .course-info {
                width: 100%;
                margin-bottom: 0.5rem;
            }
            .course-header .course-meta {
                width: 100%;
                text-align: left;
                margin-top: 0;
            }
            .course-header .expand-icon {
                margin-left: auto; 
            }
            .course-content {
                padding: 0 1.5rem 1rem 1.5rem;
            }
            .unit-item {
                padding: 0.75rem 1rem;
            }
            .unit-title {
                margin-bottom: 0.5rem;
            }
            .topic-item {
                flex-wrap: wrap;
                padding: 0.5rem 0;
            }
            .topic-item-name {
                width: calc(100% - 70px); 
                flex-grow: 1;
            }
            .topic-item-status {
                margin-left: 0;
                order: 3; 
                width: 100%;
                text-align: left;
                margin-top: 0.25rem;
            }
            .topic-action-btn {
                margin-left: auto; 
            }
            /* macOS dots on welcome section for mobile */
            #welcome-overview::before {
                top: 1rem;
                left: 1rem;
                transform: scale(0.8);
                transform-origin: top left;
            }
            #welcome-overview {
                padding-top: 2.5rem; 
            }
        }
    </style>
</head>
<body class="antialiased">

    <header>
        <div class="flex items-center gap-4">
            <img src="https://thelo.space/img/thelo-Photoroom.png" alt="Thelo logo" class="h-10 w-auto" /> 
        </div>
        <div class="flex items-center gap-4">
            <button id="open-thelobook-btn" class="thelobook-nav-btn" data-i18n="openThelobookBtn">
                <i class="fas fa-book-open mr-2"></i> Thelobook
            </button>
            <img id="profile-photo-nav" src="https://via.placeholder.com/150/2563EB/FFFFFF?text=P" alt="Profile Photo" class="profile-photo-nav" title="Profile Settings">
        </div>
    </header>

    <main>
        <section id="welcome-overview" class="mb-10">
            <h2 class="text-3xl lg:text-4xl font-extrabold text-[var(--thelo-text)] mb-8" data-i18n="welcomeGreeting">Good afternoon, <span id="student-name">Student</span>!</h2>
        </section>
        
        <section id="continue-learning" class="mb-10">
            <h2 class="text-2xl lg:text-3xl font-extrabold text-[var(--thelo-text)] mb-6" data-i18n="continueLearningSectionTitle">Continue Learning</h2>
            <div class="thelo-card max-w-xl mx-auto flex flex-col items-start">
                <p class="topic-card-context" data-i18n="lastTopicContext">Course: Math Level 1 • Unit: Fractions and Decimals</p>
                <h3 class="text-xl font-semibold text-[var(--thelo-blue)] mb-3" data-i18n="lastTopicTitle">Adding Fractions</h3>
                
                <div class="w-full mb-4">
                    <p class="text-sm text-slate-600 mb-2" data-i18n="topicProgress">Progress: <span class="font-bold">70%</span></p>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: 70%;"></div>
                    </div>
                </div>
                <div class="w-full text-sm text-slate-600 mb-4">
                    <p data-i18n="topicScoreStars">Your score: <span class="font-bold">85%</span> | Stars: <span class="font-bold">3/5</span></p>
                </div>
                <button id="resume-last-topic-btn" class="thelo-btn w-full" data-i18n="resumeTopicBtn">
                    <i class="fas fa-play-circle mr-2"></i> Resume Topic
                </button>
            </div>
        </section>

        <section id="explore-courses" class="mb-10">
            <h2 class="text-2xl lg:text-3xl font-extrabold text-[var(--thelo-text)] mb-6" data-i18n="exploreCoursesSectionTitle">Explore Your Courses</h2>

            <div id="courses-accordion">
                <div class="course-item">
                    <div class="course-header" data-course-id="math-level-1">
                        <div class="course-info">
                            <h3 class="course-title-text" data-i18n="course1Title">Math Level 1: Fundamentals</h3>
                            <p class="course-meta" data-i18n="course1Meta">4 Units • 20 Topics</p>
                        </div>
                        <div class="w-2/5 md:w-1/4">
                            <p class="text-sm text-slate-600 mb-1" data-i18n="courseProgress">Overall Progress: <span class="font-bold">50%</span></p>
                            <div class="progress-bar-container">
                                <div class="progress-bar" style="width: 50%;"></div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-down expand-icon ml-4"></i>
                    </div>
                    <div class="course-content">
                        <div class="unit-item">
                            <h4 class="unit-title" data-i18n="unit1_1Title">Whole Numbers & Operations</h4>
                            <ul class="topic-list">
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic1_1_1">Place Value</span>
                                    <span class="topic-item-status text-green-600"><i class="fas fa-check-circle mr-1"></i> <span data-i18n="statusCompleted">Completed</span></span>
                                    <button class="topic-action-btn" data-i18n="btnReview">Review</button>
                                </li>
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic1_1_2">Addition & Subtraction</span>
                                    <span class="topic-item-status text-amber-600"><i class="fas fa-clock mr-1"></i> <span data-i18n="statusInProgress">In Progress</span></span>
                                    <button class="topic-action-btn" data-i18n="btnResume">Resume</button>
                                </li>
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic1_1_3">Multiplication Basics</span>
                                    <span class="topic-item-status text-red-600"><i class="fas fa-times-circle mr-1"></i> <span data-i18n="statusNotStarted">Not Started</span></span>
                                    <button class="topic-action-btn" data-i18n="btnStart">Start</button>
                                </li>
                            </ul>
                        </div>
                        <div class="unit-item">
                            <h4 class="unit-title" data-i18n="unit1_2Title">Fractions & Decimals</h4>
                            <ul class="topic-list">
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic1_2_1">Understanding Fractions</span>
                                    <span class="topic-item-status text-green-600"><i class="fas fa-check-circle mr-1"></i> <span data-i18n="statusCompleted">Completed</span></span>
                                    <button class="topic-action-btn" data-i18n="btnReview">Review</button>
                                </li>
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic1_2_2">Adding Fractions</span>
                                    <span class="topic-item-status text-amber-600"><i class="fas fa-clock mr-1"></i> <span data-i18n="statusInProgress">In Progress</span></span>
                                    <button class="topic-action-btn" data-i18n="btnResume">Resume</button>
                                </li>
                            </ul>
                        </div>
                        </div>
                </div>

                <div class="course-item">
                    <div class="course-header" data-course-id="math-level-2">
                        <div class="course-info">
                            <h3 class="course-title-text" data-i18n="course2Title">Math Level 2: Algebra Essentials</h3>
                            <p class="course-meta" data-i18n="course2Meta">3 Units • 15 Topics</p>
                        </div>
                        <div class="w-2/5 md:w-1/4">
                            <p class="text-sm text-slate-600 mb-1" data-i18n="courseProgress">Overall Progress: <span class="font-bold">10%</span></p>
                            <div class="progress-bar-container">
                                <div class="progress-bar" style="width: 10%;"></div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-down expand-icon ml-4"></i>
                    </div>
                    <div class="course-content">
                        <div class="unit-item">
                            <h4 class="unit-title" data-i18n="unit2_1Title">Foundations of Algebra</h4>
                            <ul class="topic-list">
                                <li class="topic-item">
                                    <span class="topic-item-name" data-i18n="topic2_1_1">Variables and Expressions</span>
                                    <span class="topic-item-status text-amber-600"><i class="fas fa-clock mr-1"></i> <span data-i18n="statusInProgress">In Progress</span></span>
                                    <button class="topic-action-btn" data-i18n="btnResume">Resume</button>
                                </li>
                            </ul>
                        </div>
                        </div>
                </div>
            </div>
        </section>

        <hr class="border-t border-gray-300 my-10">

        <section id="achievements" class="mb-10">
            <h2 class="text-2xl lg:text-3xl font-extrabold text-[var(--thelo-text)] mb-6" data-i18n="achievementsSectionTitle">Your Achievements</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="achievement-card">
                    <i class="fas fa-award achievement-icon"></i>
                    <p class="achievement-message" data-i18n="achievement1Message">Completed Unit: Fractions & Decimals!</p> 
                    <p class="achievement-description" data-i18n="achievement1Desc">Great work completing a full unit!</p>
                </div>
                <div class="achievement-card">
                    <i class="fas fa-star achievement-icon"></i>
                    <p class="achievement-message" data-i18n="achievement2Message">100% on "Place Value" topic!</p>
                    <p class="achievement-description" data-i18n="achievement2Desc">Perfect score, keep it up!</p>
                </div>
                <div class="achievement-card">
                    <i class="fas fa-trophy achievement-icon"></i>
                    <p class="achievement-message" data-i18n="achievement3Message">First Course Completed!</p>
                    <p class="achievement-description" data-i18n="achievement3Desc">You mastered Math Level 1!</p>
                </div>
            </div>
        </section>

        </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signOut, onAuthStateChanged, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase configuration from environment variables
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // DOM Elements
        const mainStudentNameSpan = document.getElementById('student-name');
        const profilePhotoNav = document.getElementById('profile-photo-nav'); 
        // const userIdDisplay = document.getElementById('user-id-display'); // Removed from HTML

        // Continue Learning section elements
        const lastTopicContext = document.querySelector('#continue-learning [data-i18n="lastTopicContext"]');
        const lastTopicTitle = document.querySelector('#continue-learning [data-i18n="lastTopicTitle"]');
        const lastTopicProgress = document.querySelector('#continue-learning [data-i18n="topicProgress"] span');
        const lastTopicProgressBar = document.querySelector('#continue-learning .progress-bar');
        const lastTopicScoreStars = document.querySelector('#continue-learning [data-i18n="topicScoreStars"]');
        const resumeLastTopicBtn = document.getElementById('resume-last-topic-btn');


        // Navbar Thelobook button (moved from floating actions)
        const openThelobookBtn = document.getElementById('open-thelobook-btn');
        // Removed Quick Practice button (not needed)
        // const quickPracticeBtn = document.getElementById('quick-practice-btn');


        let isAuthReady = false; 

        // --- Internationalization Strings ---
        const strings = {
            en: {
                dashboardTitle: 'Thelo Student Dashboard',
                welcomeGreeting: 'Good afternoon, <span id="student-name">Student</span>!',
                continueLearningSectionTitle: 'Continue Learning', 
                lastTopicContext: 'Course: Math Level 1 • Unit: Fractions and Decimals',
                lastTopicTitle: 'Adding Fractions',
                topicProgress: 'Progress: <span class="font-bold">70%</span>',
                topicScoreStars: 'Your score: <span class="font-bold">85%</span> | Stars: <span class="font-bold">3/5</span>',
                resumeTopicBtn: 'Resume Topic',

                exploreCoursesSectionTitle: 'Explore Your Courses',
                course1Title: 'Math Level 1: Fundamentals',
                course1Meta: '4 Units • 20 Topics',
                course2Title: 'Math Level 2: Algebra Essentials',
                course2Meta: '3 Units • 15 Topics',
                courseProgress: 'Overall Progress: <span class="font-bold">0%</span>', // Placeholder for course progress

                unit1_1Title: 'Whole Numbers & Operations',
                topic1_1_1: 'Place Value',
                topic1_1_2: 'Addition & Subtraction',
                topic1_1_3: 'Multiplication Basics',
                unit1_2Title: 'Fractions & Decimals',
                topic1_2_1: 'Understanding Fractions',
                topic1_2_2: 'Adding Fractions',

                unit2_1Title: 'Foundations of Algebra',
                topic2_1_1: 'Variables and Expressions',

                statusCompleted: 'Completed',
                statusInProgress: 'In Progress',
                statusNotStarted: 'Not Started',
                btnReview: 'Review',
                btnResume: 'Resume',
                btnStart: 'Start',

                achievementsSectionTitle: 'Your Achievements', 
                achievement1Message: 'Completed Unit: Fractions & Decimals!', 
                achievement1Desc: 'Great work completing a full unit!',
                achievement2Message: '100% on "Place Value" topic!',
                achievement2Desc: 'Perfect score, keep it up!',
                achievement3Message: 'First Course Completed!',
                achievement3Desc: 'You mastered Math Level 1!',

                // Removed Quick Practice button text
                // startQuickPracticeBtn: 'Quick Practice', 
                openThelobookBtn: 'Thelobook', // Updated button text for navbar
            },
            hy: {
                dashboardTitle: 'Թելո Ուսանողի Վահանակ',
                welcomeGreeting: 'Բարի կեսօր, <span id="student-name">Ուսանող</span>!',
                continueLearningSectionTitle: 'Շարունակել Ուսումը', 
                lastTopicContext: 'Դասընթաց: Մաթեմատիկա Մակարդակ 1 • Մոդուլ: Կոտորակներ և Տասնորդականներ',
                lastTopicTitle: 'Կոտորակների Գումարում',
                topicProgress: 'Առաջընթաց: <span class="font-bold">70%</span>',
                topicScoreStars: 'Ձեր գնահատականը: <span class="font-bold">85%</span> | Աստղեր: <span class="font-bold">3/5</span>',
                resumeTopicBtn: 'Շարունակել Թեման',

                exploreCoursesSectionTitle: 'Բացահայտեք Ձեր Դասընթացները',
                course1Title: 'Մաթեմատիկա Մակարդակ 1: Հիմունքներ',
                course1Meta: '4 Մոդուլ • 20 Թեմա',
                course2Title: 'Մաթեմատիկա Մակարդակ 2: Հանրահաշվի Հիմունքներ',
                course2Meta: '3 Մոդուլ • 15 Թեմա',
                courseProgress: 'Ընդհանուր Առաջընթաց: <span class="font-bold">0%</span>',

                unit1_1Title: 'Ամբողջ թվեր և գործողություններ',
                topic1_1_1: 'Կարգային արժեք',
                topic1_1_2: 'Գումարում և հանում',
                topic1_1_3: 'Բազմապատկման հիմունքներ',
                unit1_2Title: 'Կոտորակներ և տասնորդականներ',
                topic1_2_1: 'Կոտորակների հասկացություն',
                topic1_2_2: 'Կոտորակների գումարում',
                
                unit2_1Title: 'Հանրահաշվի հիմունքներ',
                topic2_1_1: 'Փոփոխականներ և արտահայտություններ',

                statusCompleted: 'Ավարտված',
                statusInProgress: 'Ընթացքի մեջ',
                statusNotStarted: 'Չսկսված',
                btnReview: 'Վերանայել',
                btnResume: 'Շարունակել',
                btnStart: 'Սկսել',

                achievementsSectionTitle: 'Ձեր Ձեռքբերումները', 
                achievement1Message: 'Ավարտված Մոդուլ: Կոտորակներ և Տասնորդականներ!', 
                achievement1Desc: 'Հիանալի աշխատանք՝ ավարտելով ամբողջ մոդուլը։',
                achievement2Message: '100% "Կարգային արժեք" թեմայից։',
                achievement2Desc: 'Կատարյալ գնահատական, շարունակեք այդպես։',
                achievement3Message: 'Առաջին դասընթացը ավարտված է։',
                achievement3Desc: 'Դուք յուրացրել եք Մաթեմատիկա Մակարդակ 1-ը։',

                // Removed Quick Practice button text
                // startQuickPracticeBtn: 'Արագ Գործնական Աշխատանք', 
                openThelobookBtn: 'Թելոգիրք', // Updated button text for navbar
            }
        };

        let currentLang = 'en'; 

        function applyLang(lang) {
            document.documentElement.lang = lang;
            const t = strings[lang] || strings.en;
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const k = el.dataset.i18n;
                if (t[k]) {
                    el.innerHTML = t[k]; 
                }
            });
            
            // Retain dynamic content after language switch
            if (mainStudentNameSpan) mainStudentNameSpan.textContent = mainStudentNameSpan.textContent; 

            // Update specific span texts for Continue Learning section
            if (lastTopicProgress) lastTopicProgress.textContent = lastTopicProgress.textContent;
            if (lastTopicScoreStars) {
                const scoreSpan = lastTopicScoreStars.querySelector('.font-bold:nth-of-type(1)');
                const starsSpan = lastTopicScoreStars.querySelector('.font-bold:nth-of-type(2)');
                const currentScore = scoreSpan ? scoreSpan.textContent : '0%';
                const currentStars = starsSpan ? starsSpan.textContent : '0/5';
                
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = t.topicScoreStars;
                const newScoreSpan = tempDiv.querySelector('.font-bold:nth-of-type(1)');
                const newStarsSpan = tempDiv.querySelector('.font-bold:nth-of-type(2)');

                if (newScoreSpan) newScoreSpan.textContent = currentScore;
                if (newStarsSpan) newStarsSpan.textContent = currentStars;
                lastTopicScoreStars.innerHTML = tempDiv.innerHTML;
            }
        }

        async function updateDashboard(user) {
            if (!db) {
                console.error("Firestore is not initialized.");
                return;
            }

            // if (userIdDisplay) userIdDisplay.textContent = user.uid; // Removed from HTML

            const userProfileRef = doc(db, 'artifacts', appId, 'users', user.uid, 'user_profile', 'profile');
            try {
                const docSnap = await getDoc(userProfileRef);
                if (docSnap.exists()) {
                    const userData = docSnap.data();
                    const userName = userData.name || 'Student';
                    if (mainStudentNameSpan) mainStudentNameSpan.textContent = userName; 

                    // Simulate dynamic content for "Continue Learning"
                    const simulatedProgress = Math.floor(Math.random() * 100);
                    const simulatedScore = Math.floor(Math.random() * 20) + 70; // 70-90%
                    const simulatedStars = `${Math.floor(Math.random() * 5) + 1}/5`;

                    if(lastTopicProgress) lastTopicProgress.textContent = `${simulatedProgress}%`;
                    if(lastTopicProgressBar) lastTopicProgressBar.style.width = `${simulatedProgress}%`;
                    if(lastTopicScoreStars) {
                        const currentLangStrings = strings[currentLang];
                        lastTopicScoreStars.innerHTML = currentLangStrings.topicScoreStars
                            .replace(/<span.*?<\/span>/, `<span class="font-bold">${simulatedScore}%</span>`)
                            .replace(/<span.*?<\/span>$/, `<span class="font-bold">${simulatedStars}</span>`);
                    }

                } else {
                    console.warn("No user profile found for UID:", user.uid);
                    if (mainStudentNameSpan) mainStudentNameSpan.textContent = 'New Student';
                }
            } catch (error) {
                console.error("Error fetching user profile:", error);
                if (mainStudentNameSpan) mainStudentNameSpan.textContent = 'Student';
            }
            applyLang(currentLang); 
        }

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                console.log("User is authenticated:", user.uid);
                if (typeof __initial_auth_token !== 'undefined' && !isAuthReady) {
                    try {
                        await signInWithCustomToken(auth, __initial_auth_token);
                        console.log("Signed in with initial custom token.");
                        await updateDashboard(user); 
                    } catch (error) {
                        console.error("Error signing in with initial custom token:", error);
                        await signInAnonymously(auth); 
                        console.log("Signed in anonymously after custom token failure.");
                        await updateDashboard(auth.currentUser); 
                    }
                } else if (!isAuthReady) {
                    await updateDashboard(user);
                } else if (user.isAnonymous && !isAuthReady) {
                    console.log("User already anonymous. Proceeding to update dashboard.");
                    await updateDashboard(user);
                }
            } else {
                console.log("No user authenticated. Redirecting to login.");
                if (isAuthReady) { 
                    window.location.href = 'index.html'; 
                }
            }
            isAuthReady = true; 
        });

        if (profilePhotoNav) {
            profilePhotoNav.addEventListener('click', () => {
                window.location.href = 'https://thelo.space/settings'; 
            });
        }

        // Accordion functionality for Explore Your Courses
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            currentLang = params.get('lang') || 'en';
            applyLang(currentLang);

            document.querySelectorAll('.course-header').forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling; 
                    const expandIcon = header.querySelector('.expand-icon');

                    header.classList.toggle('expanded');

                    if (content.classList.contains('active')) {
                        content.classList.remove('active');
                        content.style.maxHeight = null; 
                    } else {
                        content.classList.add('active');
                        content.style.maxHeight = content.scrollHeight + "px"; 
                    }
                });
            });

            // Handle actions for topics (Start, Resume, Review)
            document.querySelectorAll('.topic-action-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    event.stopPropagation(); 
                    const topicName = event.target.closest('.topic-item').querySelector('.topic-item-name').textContent;
                    const action = event.target.textContent.trim(); 
                    alert(`${action} Topic: ${topicName}`);
                });
            });

            // Resume Last Topic Button
            if (resumeLastTopicBtn) {
                resumeLastTopicBtn.addEventListener('click', () => {
                    const topicTitle = lastTopicTitle.textContent;
                    alert(`Resuming last topic: ${topicTitle}!`);
                });
            }

            // Thelobook button on Navbar
            if (openThelobookBtn) {
                openThelobookBtn.addEventListener('click', () => {
                    alert('Opening Thelobook!'); 
                });
            }
            // Quick Practice button is removed, so its event listener is gone.
        });
    </script>
</body>
</html>
